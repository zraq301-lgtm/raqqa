<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø±ÙƒØ² Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ØµØ­ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --p2: #eb2f96; --bg: #fff9fb; }
        body { font-family: 'Tajawal', sans-serif; background-color: var(--bg); margin: 0; padding: 0; }
        .header { background: white; padding: 15px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .container { padding: 20px; max-width: 500px; margin: 0 auto; }
        .notif-card { 
            background: white; padding: 15px; margin-bottom: 15px; border-radius: 15px; 
            border-right: 5px solid var(--p2); position: relative; transition: 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.02);
        }
        .delete-btn {
            position: absolute; left: 10px; top: 10px; background: #fee2e2; color: #ef4444; 
            border: none; width: 28px; height: 28px; border-radius: 50%; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
        }
        .time-tag { font-size: 11px; color: #aaa; margin-top: 8px; display: block; }
    </style>
</head>
<body>
    <div class="header">
        <h3>ğŸ”” ØªÙ†Ø¨ÙŠÙ‡Ø§ØªÙŠ Ø§Ù„ØµØ­ÙŠØ©</h3>
        <a href="/" style="text-decoration:none; color:var(--p2); font-weight:bold;">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    </div>
    
    <div class="container">
        <div id="notif-list"></div>
        <div id="status" style="text-align:center; color:var(--p2); margin-top:20px;">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø¢Ø®Ø± Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª...</div>
    </div>

<script>
    const currentUserId = new URLSearchParams(window.location.search).get('user_id') || '1';

    async function loadNotifications() {
        try {
            const response = await fetch(`/api/notifications?user_id=${currentUserId}`);
            const data = await response.json();
            
            const listDiv = document.getElementById('notif-list');
            const statusDiv = document.getElementById('status');

            if (data.success && data.notifications.length > 0) {
                statusDiv.style.display = 'none';
                listDiv.innerHTML = data.notifications.map(n => `
                    <div class="notif-card" id="card-${n.id}">
                        <button class="delete-btn" onclick="deleteNotif(${n.id})">âœ•</button>
                        <div style="font-weight:bold; color:var(--p2);">ğŸŒ¸ ${n.title}</div>
                        <div style="font-size:14px; color:#444; margin-top:8px; line-height:1.6;">${n.body}</div>
                        <span class="time-tag">ğŸ“… ${new Date(n.created_at).toLocaleString('ar-EG')}</span>
                    </div>
                `).join('');
            } else {
                listDiv.innerHTML = '<div style="text-align:center; margin-top:50px;"><p style="color:#999;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ âœ¨</p></div>';
                statusDiv.innerText = "";
            }
        } catch (e) { 
            statusDiv.innerText = "ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"; 
        }
    }

    // Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© Ù„Ù„Ø­Ø°Ù Ø§Ù„Ù…ØªÙˆØ§ÙÙ‚Ø© Ù…Ø¹ Ø§Ù„Ù€ API Ø§Ù„Ø¬Ø¯ÙŠØ¯
    async function deleteNotif(id) {
        if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ÙŠÙ† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) return;
        try {
            const response = await fetch(`/api/delete-notification?id=${id}`, { 
                method: 'DELETE' // ØªØ£ÙƒÙŠØ¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… DELETE Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† GET
            });
            
            if (response.ok) {
                const element = document.getElementById(`card-${id}`);
                element.style.opacity = '0';
                setTimeout(() => element.remove(), 300); // Ø­Ø°Ù Ø§Ù„Ø¹Ù†ØµØ± Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ø­Ø±ÙƒØ© Ù†Ø§Ø¹Ù…Ø©
            } else {
                alert("ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…");
            }
        } catch (e) { 
            alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©"); 
        }
    }

    window.onload = loadNotifications;
    setInterval(loadNotifications, 60000); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
</script>
</body>
</html>
