<!       alert('تم تفعيل وضع حذف المحتوى. انقر على أي محتوى (البوح أو بوست) لحذفه. لإلغاء الوضع، اضغط على الزر "حذف محتوى" مرة أخرى.');
            } else {
                alert('تم إلغاء وضع حذف المحتوى.');
            }
        }

        )
            true;

            const generatedText = await fetchGeminiContent(prompt, type);
            
            startTypingEffect(generatedText, outputElement, useBtn);
        }

        function useAIContent() {
            const useBtn = document.getElementById('useAIBtn');
            const content = useBtn.getAttribute('data-content');
            const type = document.querySelector('.ai-option-btn.active').getAttribute('data-type');
            
            if (content) {
                const targetSection = document.getElementById('adminSectionSelect');
                const sectionName = targetSection.options[targetSection.selectedIndex].text;
                const sectionId = targetSection.value;
                
                // تعبئة البيانات مباشرة في نافذة الرفع
                closeModal('aiGeneratorModal');
                openUploadPostModal(type);
                document.getElementById('postContent').value = content;
                
                alert(`تم نقل محتوى ${type} المولد إلى نافذة الرفع. يرجى مراجعة المحتوى والضغط على "رفع المحتوى".`);
            }
        }


        // --- وظائف أدوات التتبع (Tracker Functions) ---
        
        function toggleTracker(id) {
            document.querySelectorAll('.tracker-ui').forEach(ui => {
                if (ui.id === id) {
                    ui.style.display = ui.style.display === 'block' ? 'none' : 'block';
                } else {
                    ui.style.display = 'none'; // إخفاء الأدوات الأخرى
                }
            });
        }

        function calculateCycle(event) {
            event.preventDefault();
            const lastPeriodDate = document.getElementById('lastPeriodDate').value;
            const cycleLength = parseInt(document.getElementById('cycleLength').value);
            const resultDiv = document.getElementById('cycleResult');

            if (!lastPeriodDate || isNaN(cycleLength)) {
                resultDiv.textContent = 'الرجاء إدخال بيانات صحيحة.';
                resultDiv.style.display = 'block';
                return;
            }

            const lastDate = new Date(lastPeriodDate);
            // حساب تاريخ الدورة القادمة
            const nextDate = new Date(lastDate);
            nextDate.setDate(nextDate.getDate() + cycleLength);

            // حساب فترة التبويض (عادةً 14 يوماً قبل الدورة القادمة)
            const ovulationStart = new Date(nextDate);
            ovulationStart.setDate(ovulationStart.getDate() - 16);
            const ovulationEnd = new Date(nextDate);
            ovulationEnd.setDate(ovulationEnd.getDate() - 12);
            
            const formatter = new Intl.DateTimeFormat('ar-EG', { day: 'numeric', month: 'long', year: 'numeric' });

            resultDiv.innerHTML = `
                <p style="margin: 0;">**تاريخ الدورة القادمة المتوقع:** <br> <i class="fas fa-calendar-alt"></i> ${formatter.format(nextDate)}</p>
                <p style="margin-top: 10px;">**فترة التبويض الخصبة:** <br> <i class="fas fa-venus"></i> ${formatter.format(ovulationStart)} إلى ${formatter.format(ovulationEnd)}</p>
            `;
            resultDiv.style.display = 'block';
        }

        function calculatePregnancy(event) {
            event.preventDefault();
            const lastPeriodDateLMP = document.getElementById('lastPeriodDateLMP').value;
            const resultDiv = document.getElementById('pregnancyResult');

            if (!lastPeriodDateLMP) {
                resultDiv.textContent = 'الرجاء إدخال تاريخ آخر دورة.';
                resultDiv.style.display = 'block';
                return;
            }

            const lmp = new Date(lastPeriodDateLMP);
            const today = new Date();
            const formatter = new Intl.DateTimeFormat('ar-EG', { day: 'numeric', month: 'long', year: 'numeric' });

            // حساب موعد الولادة المتوقع (EDD) باستخدام قاعدة نيجل (280 يومًا من LMP)
            const edd = new Date(lmp);
            edd.setDate(edd.getDate() + 280); 
            
            // حساب الأسابيع المكتملة
            const diffTime = Math.abs(today - lmp);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            const weeks = Math.floor(diffDays / 7);
            const remainingDays = diffDays % 7;


            resultDiv.innerHTML = `
                <p style="margin: 0; font-size: 1.1rem;">**موعد الولادة المتوقع (EDD):** <br> <i class="fas fa-gift"></i> ${formatter.format(edd)}</p>
                <p style="margin-top: 10px;">**أنتِ حالياً في:** <br> <i class="fas fa-baby-carriage"></i> الأسبوع ${weeks} ويوم ${remainingDays}</p>
            `;
            resultDiv.style.display = 'block';
        }

        function calculateSkinCare(event) {
            event.preventDefault();
            const skinType = document.getElementById('skinType').value;
            const skinGoals = document.getElementById('skinGoals').value;
            const resultDiv = document.getElementById('skinCareResult');

            if (!skinType) {
                resultDiv.textContent = 'الرجاء اختيار نوع البشرة.';
                resultDiv.style.display = 'block';
                return;
            }
            
            let routine = '';
            if (skinType === 'جافة') {
                routine = 'روتين البشرة الجافة: منظف كريمي، سيروم هيالورونيك، مرطب غني، واقي شمسي بزبدة الشيا.';
            } else if (skinType === 'دهنية') {
                routine = 'روتين البشرة الدهنية: منظف رغوي/جل، تونر حمض الساليسيليك، مرطب خفيف (جل)، واقي شمسي بتركيبة مات.';
            } else if (skinType === 'مختلطة') {
                routine = 'روتين البشرة المختلطة: منظف جل، ترطيب المناطق الجافة بكريم، والمناطق الدهنية بجل خفيف.';
            } else if (skinType === 'حساسة') {
                 routine = 'روتين البشرة الحساسة: منظف لطيف خالٍ من العطور، سيروم سنتيلا، مرطب مهدئ، واقي شمسي معدني.';
            } else {
                routine = 'لم يتم تحديد نوع البشرة بشكل دقيق.';
            }
            
            resultDiv.innerHTML = `
                <p style="margin: 0; font-size: 1.1rem;">**الروتين المقترح للبشرة ${skinType}:**</p>
                <p style="margin-top: 10px; text-align: right; font-weight: normal;">${routine}</p>
                <p style="margin-top: 10px; font-size: 0.85rem; color: #a0522d; font-weight: normal;">*هدف العناية المدخل: ${skinGoals.substring(0, 50)}...*</p>
            `;
            
            resultDiv.style.display = 'block';
            document.getElementById('skinCareTracker').querySelector('.tracker-result').style.background = '#fce4ec';
            document.getElementById('skinCareTracker').querySelector('.tracker-result').style.color = '#ff80ab';
        }

        function addNursingLog(event) {
            event.preventDefault();
            const time = document.getElementById('nursingTime').value;
            const side = document.getElementById('nursingSide').value;
            const duration = document.getElementById('nursingDuration').value;

            const newEntry = {
                time: time,
                side: side,
                duration: parseInt(duration),
                date: new Date().toLocaleDateString('ar-EG')
            };

            nursingLog.push(newEntry);
            saveAppData();
            loadNursingLog();
            
            // تنظيف النموذج
            document.getElementById('nursingTime').value = '';
            document.getElementById('nursingDuration').value = '';
            
            alert('تم تسجيل الرضاعة بنجاح.');
        }

        function loadNursingLog() {
            const container = document.getElementById('nursingLogContainer');
            container.innerHTML = '';
            
            if (nursingLog.length === 0) {
                container.innerHTML = '<p style="color: #999; text-align: center;">لا يوجد سجلات.</p>';
                return;
            }

            // عرض آخر 5 سجلات فقط
            const latestLogs = nursingLog.slice(-5).reverse();

            latestLogs.forEach((log, index) => {
                const logEl = document.createElement('div');
                logEl.className = 'nursing-log';
                logEl.innerHTML = `
                    <span>${log.date} @ ${log.time} - ${log.side} (${log.duration} دقيقة)</span>
                    <button onclick="deleteNursingLog(${nursingLog.length - 1 - index})">حذف</button>
                `;
                container.appendChild(logEl);
            });
        }
        
        function deleteNursingLog(index) {
            if (confirm('هل أنت متأكد من حذف هذا السجل؟')) {
                nursingLog.splice(index, 1);
                saveAppData();
                loadNursingLog();
                alert('تم حذف السجل.');
            }
        }
        
        // --- وظائف إغلاق النوافذ (Close Modals) ---
        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }


        // --- معالج بدء التشغيل ---
        document.addEventListener('DOMContentLoaded', () => {
            // إضافة معالجات إغلاق للـ Overlays
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        overlay.style.display = 'none';
                    }
                });
            });

            // تحميل البيانات عند بدء التشغيل
            loadAppData(); 
            loadNursingLog(); 

            // التحقق من حالة تسجيل دخول المشرف
            if (localStorage.getItem('isAdminLoggedIn') === 'true') {
                document.getElementById('adminToggleBtn').style.display = 'flex';
                // لا نعرض لوحة التحكم مباشرة، فقط نتيح الزر
            } else {
                 document.getElementById('adminDashboard').style.display = 'none';
            }
            
            // التأكد من أن الرئيسة معروضة كقسم افتراضي
            showSection('homeView', document.querySelector('.nav-item.active'));
        });
        
    </script>
</body>
</html>

