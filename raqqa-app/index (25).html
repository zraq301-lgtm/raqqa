<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุชุทุจูู ุฑูุฉ | ุงูููุตุฉ ุงููุชูุงููุฉ</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root { 
            --p1: #ff85c0; --p2: #eb2f96; --purp: #722ed1; 
            --bg: #fffcfd; --soft: #fff0f6; --gold: #faad14;
            --glass: rgba(255, 255, 255, 0.95);
        }
        body { font-family: 'Tajawal', sans-serif; background: var(--bg); margin: 0; padding-bottom: 100px; color: #444; overflow-x: hidden; }
        
        /* Header */
        .top-nav { background: var(--glass); backdrop-filter: blur(10px); padding: 15px 20px; display: flex; justify-content: center; box-shadow: 0 2px 15px rgba(0,0,0,0.05); position: sticky; top:0; z-index:1001; }
        .logo-text { font-weight: 800; color: var(--p2); font-size: 26px; }

        .page { display: none; padding: 15px; animation: fadeIn 0.5s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from {opacity:0; transform: translateY(10px);} to {opacity:1; transform: translateY(0);} }

        /* AI Buttons */
        .ai-header-btn { color: white; border: none; width: 100%; padding: 16px; border-radius: 18px; font-weight: bold; margin-bottom: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 12px; font-family: 'Tajawal'; font-size: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transition: 0.3s; }
        .btn-health { background: linear-gradient(135deg, #eb2f96, #ff4d4f); }
        .btn-intimacy { background: linear-gradient(135deg, #800020, #faad14); } /* ุฃููุงู ุนูุงุจูุฉ ูุฐูุจูุฉ ููุญููููุฉ */

        /* Health & Intimacy Cards */
        .grid-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 25px; }
        .card-item { background: #fff; padding: 20px 10px; border-radius: 22px; text-align: center; border: 1.5px solid var(--soft); box-shadow: 0 4px 12px rgba(0,0,0,0.03); transition: 0.3s; cursor: pointer; }
        .card-item:hover { transform: translateY(-5px); border-color: var(--p1); }
        .card-item i { font-size: 32px; margin-bottom: 10px; display: block; }
        .card-item span { font-size: 14px; font-weight: 700; color: #444; }

        /* Form Styling */
        .swal-label { display: block; text-align: right; margin-top: 12px; font-weight: bold; color: var(--p2); font-size: 14px; }
        .swal-custom-input { width: 100%; padding: 12px; margin-top: 5px; border-radius: 12px; border: 1px solid #ddd; font-family: 'Tajawal'; box-sizing: border-box; }
        .swal-back-btn { background: #eee; color: #333; border: none; padding: 6px 15px; border-radius: 8px; cursor: pointer; font-family: 'Tajawal'; margin-bottom: 15px; display: flex; align-items: center; gap: 5px; font-size: 13px; }

        /* Chat UI */
        #chat-overlay { display: none; position: fixed; inset: 0; background: white; z-index: 2000; flex-direction: column; }
        .chat-header { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; justify-content: space-between; }
        .chat-messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; background: #fdfbfd; }
        .msg { padding: 14px 18px; border-radius: 20px; max-width: 80%; font-size: 14px; line-height: 1.6; }
        .msg-user { align-self: flex-start; background: #f0f0f0; }
        .msg-ai { align-self: flex-end; background: var(--p2); color: white; }
        .chat-footer { padding: 15px; display: flex; gap: 10px; background: white; border-top: 1px solid #eee; }
        .chat-input { flex: 1; padding: 12px 20px; border-radius: 30px; border: 1.5px solid #eee; outline: none; font-family: 'Tajawal'; }

        /* Nav Bar */
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: white; display: flex; border-top: 1px solid #eee; padding: 12px 0 25px 0; z-index: 1000; }
        .nav-link { flex: 1; text-align: center; color: #bbb; text-decoration: none; font-size: 12px; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .nav-link i { font-size: 24px; }
        .nav-link.active { color: var(--p2); font-weight: bold; }
    </style>
</head>
<body>

    <header class="top-nav"><div class="logo-text">ุฑูุฉ</div></header>

    <div id="page-health" class="page active">
        <button class="ai-header-btn btn-health" onclick="openAIChat('ุทุจูุจุฉ ุฑูุฉ')"><i class="fas fa-stethoscope"></i> ุชุญููู ุตุญู ุดุงูู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู</button>
        <div class="grid-container" id="health-grid">
            </div>
    </div>

    <div id="page-intimacy" class="page">
        <button class="ai-header-btn btn-intimacy" onclick="openAIChat('ูุณุชุดุงุฑุฉ ุงูุนูุงูุงุช')"><i class="fas fa-venus-mars"></i> ูุญูู ุงูุนูุงูุงุช ุงูุฒูุฌูุฉ ุงูุฐูู</button>
        <div class="grid-container" id="intimacy-grid">
            </div>
    </div>

    <div id="chat-overlay">
        <div class="chat-header">
            <i class="fas fa-times" onclick="closeChat()" style="font-size: 22px; color: #999; cursor: pointer;"></i>
            <span id="chat-title" style="font-weight:bold; color: var(--p2);">ุทุจูุจุฉ ุฑูุฉ</span>
            <i class="fas fa-robot" style="color: var(--p2);"></i>
        </div>
        <div id="chat-messages" class="chat-messages"></div>
        <div class="chat-footer">
            <input type="text" id="chat-input" class="chat-input" placeholder="ุงูุชุจู ุณุคุงููู ููุง...">
            <button onclick="sendMessage()" style="background:var(--p2); color:white; border:none; width:48px; height:48px; border-radius:50%;"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <nav class="nav-bar">
        <a href="#" class="nav-link" onclick="nav('intimacy', this)"><i class="fas fa-venus-mars"></i><span>ุงูุญููููุฉ</span></a>
        <a href="#" class="nav-link active" onclick="nav('health', this)"><i class="fas fa-heartbeat"></i><span>ุงูุตุญุฉ</span></a>
    </nav>

    <script>
        // --- ูุงุนุฏุฉ ุจูุงูุงุช ูุณู ุงูุตุญุฉ (ุฃูุซุฑ ูู 200 ุญูู) ---
        const healthData = {
            menstruation: { title: 'ูุชุงุจุนุฉ ุงูุญูุถ', icon: 'fa-tint', color: '#ff4d4f', sub: {
                "ุณุฌู ุงูุชูุงุฑูุฎ ๐": ["ุชุงุฑูุฎ ุงูุจุฏุก", "ุชุงุฑูุฎ ุงูุงูุชูุงุก", "ูุฏุฉ ุงูุฏูุฑุฉ", "ุบุฒุงุฑุฉ ุงูุชุฏูู"],
                "ุงูุฃุนุฑุงุถ ุงูุฌุณุฏูุฉ ๐": ["ุชุดูุฌุงุช", "ุงูุชูุงุฎ", "ุตุฏุงุน", "ุฃูู ุธูุฑ"],
                "ุงูุญุงูุฉ ุงููุฒุงุฌูุฉ ๐ฐ": ["ููู", "ุนุตุจูุฉ", "ูุฏูุก", "ุฑุบุจุฉ ุจุงูุจูุงุก"],
                "ุงูุตุญุฉ ุงูุฒูุฌูุฉ ๐ฅ": ["ุชูุจููุงุช ุงูุฎุตูุจุฉ", "ุชุญุฐูุฑุงุช ุทุจูุฉ", "ุฌูุงู ููุจูู"],
                "ุงูุชุบุฐูุฉ ๐ง": ["ุดุฑุจ ุงููุงุก", "ูุบููุณููู", "ุชุฌูุจ ุงููุงูููู"],
                "ุงููุดุงุท ุงูุจุฏูู ๐งโโ๏ธ": ["ููุบุง", "ูุดู ุฎููู", "ุฅุทุงูุฉ"],
                "ุงููุธุงูุฉ ุงูุดุฎุตูุฉ ๐งผ": ["ุณุฌู ุงูุชุบููุฑ", "ููุชุฌุงุช ุงูุฑุนุงูุฉ"]
            }},
            pregnancy: { title: 'ูุชุงุจุนุฉ ุงูุญูู', icon: 'fa-baby', color: '#eb2f96', sub: {
                "ููู ุงูุฌููู ๐ฃ": ["ุงููุฒู โ๏ธ", "ุงูุทูู ๐", "ูุจุถ ุงูููุจ โค๏ธ", "ุงูุญุฑูุฉ", "ุฑุฃุณ ุงูุฌููู", "ุงูุณุงุฆู ุงูุฃููููุณู"],
                "ุตุญุฉ ุงูุฃู ๐ฉบ": ["ุงูุถุบุท", "ุงูุณูุฑ", "ุงูุบุซูุงู", "ุงููุฒู", "ุชูุฑู ุงููุฏููู"],
                "ุงููุญูุตุงุช ๐งช": ["ุงูุณููุงุฑ", "ูุญุต ุงูุฏู", "ูุญุต ุงูุจูู", "ููุนุฏ ุงููุงุฏู"],
                "ุณุฌู ุงูููููุงุช ๐": ["ููููู ุฃุณูุฏ", "ุญุฏูุฏ", "ูุงูุณููู", "ุฃูููุฌุง 3"],
                "ุงูุงุณุชุนุฏุงุฏ ููููุงุฏุฉ ๐": ["ุชูุงุฑูู ุงูุชููุณ", "ุญููุจุฉ ุงููุณุชุดูู", "ุฎุทุฉ ุงูููุงุฏุฉ"],
                "ุงููุดุงุท ุงูุจุฏูู ๐โโ๏ธ": ["ุณุจุงุญุฉ", "ูุดู", "ุชูุงุฑูู ุงูุญูุถ"],
                "ุงูุชุบุฐูุฉ ๐": ["ุงูุณุนุฑุงุช", "ุงูุจุฑูุชูู", "ุงูุฃููุงู"]
            }},
            lactation: { title: 'ูุธุงู ุงูุฑุถุงุนุฉ', icon: 'fa-magic', color: '#722ed1', sub: {
                "ุณุฌู ุงูุฑุถุงุนุฉ ๐คฑ": ["ุงูููุช", "ุงูุฌูุฉ ูููู/ูุณุงุฑ", "ุงููุฏุฉ"],
                "ุงูุฑุถุงุนุฉ ุงูุตูุงุนูุฉ ๐ผ": ["ุงููููุฉ ูู", "ููุน ุงูุญููุจ"],
                "ุตุญุฉ ุงูุซุฏู ๐งผ": ["ุชุญุฌุฑ", "ุชุดููุงุช", "ุชูุธูู"],
                "ุชุบุฐูุฉ ุงููุฑุถุน ๐ฟ": ["ุณูุงุฆู", "ูุฏุฑุงุช ุงูุญููุจ"],
                "ุญุงูุฉ ุงูุฑุถูุน ๐ด": ["ุนุฏุฏ ุงูุญูุงุถุงุช", "ุฌูุฏุฉ ุงูููู"],
                "ุงูุดูุท ํ": ["ูููุฉ ุงูุดูุท", "ุชุงุฑูุฎ ุงูุตูุงุญูุฉ"],
                "ุงูุญุงูุฉ ุงูููุณูุฉ ๐ซ": ["ุฏุนู ุนุงุทูู", "ุณุงุนุงุช ุงูุฑุงุญุฉ"]
            }},
            doctor: { title: 'ูุชุงุจุนุฉ ุงูุทุจูุจ', icon: 'fa-user-md', color: '#2f54eb', sub: {
                "ุงูุนูุงุฏุฉ ๐ฅ": ["ุงูุชุงุฑูุฎ", "ุงุณู ุงูุทุจูุจ", "ุงูุชุดุฎูุต", "ุงูุฏูุงุก", "ุงูููุนุฏ ุงููุงุฏู", "ุงูููุงุญุธุงุช", "ุงูุชุฎุตุต"]
            }},
            fitness: { title: 'ุงูุฑุดุงูุฉ ูุงููุฒู', icon: 'fa-weight', color: '#faad14', sub: {
                "ููุงุณุงุช ุงูุฌุณู ๐": ["ุงูุฎุตุฑ", "ุงููุฑู", "ุงูุตุฏุฑ", "ุงููุฒู"],
                "ุงูุณุนุฑุงุช ๐ฅ": ["ุงููุชูุงููุฉ", "ุงููุญุฑููุฉ"],
                "ุงููุงุก ูุงูุชูุงุฑูู ๐โโ๏ธ": ["ุดุฑุจ ุงููุงุก", "ููุน ุงูุชูุฑูู", "ุงูุฎุทูุงุช"],
                "ุงูููู ูุงูุตูุงู ๐ค": ["ุฌูุฏุฉ ุงูููู", "ุงูุตูุงู ุงููุชูุทุน"]
            }},
            beauty: { title: 'ุงูุฃูุงูุฉ ูุงูุฌูุงู', icon: 'fa-spa', color: '#13c2c2', sub: {
                "ุงูุฑูุชูู ุงููููู โจ": ["ุจุดุฑุฉ", "ุดุนุฑ", "ุฃุธุงูุฑ"],
                "ุนูุงูุฉ ูุชูุฏูุฉ ๐งด": ["ููุงูุญุฉ ุงูุดูุฎูุฎุฉ", "ุชุฑุทูุจ ุงูุฌุณู", "ุชูุดูุฑ"],
                "ุณุชุงูู ๐": ["ุชูุณูู ุงูููุงุจุณ", "ุงูุตุญุฉ ุงูุฌูุงููุฉ"]
            }}
        };

        // --- ูุงุนุฏุฉ ุจูุงูุงุช ูุณู ุงูุญููููุฉ (10 ููุงุฆู ร 15 ูุฏุฎู) ---
        const intimacyData = {
            emotional: { title: 'ุงููุฏ ูุงูุงุชุตุงู', icon: 'fa-heart', sub: {
                "ุงูุงุฑุชุจุงุท ุงูุนุงุทูู ๐ฃ๏ธ": ["ูุบุฉ ุงูุญูุงุฑ", "ุชุจุงุฏู ุงููุธุฑุงุช", "ูููุงุช ุงูุชูุฏูุฑ", "ุงููุฏุงูุง", "ุงูุฏุนู", "ุงูุถุญู", "ููุช ุฎุงุต", "ุงูููุณ ุงูุนููู", "ุงูุฃูุงู", "ุงูุชุณุงูุญ"]
            }},
            sensuality: { title: 'ูุบุฉ ุงูุฌุณุฏ', icon: 'fa-fire', sub: {
                "ุงูุชูููุฏ ูุงูููุงุทูุฉ ๐": ["ุงููุจูุงุช", "ุงูุฃุญุถุงู", "ุงูููุงุทูุฉ", "ูุบุฉ ุงูุนููู", "ููุณ", "ุชุฏููู", "ูุธุงูุฉ", "ุชุฃูู"]
            }},
            physical: { title: 'ุงูุตุญุฉ ุงูุชุจุงุฏููุฉ', icon: 'fa-venus-mars', sub: {
                "ุงูููุงุก ุงูุฌูุณู ๐ก๏ธ": ["ุชูุงูู ุงูุฑุบุจุฉ", "ุงููุจุงุฏุฑุฉ", "ุงุณุชูุดุงู", "ุงูุชูุงุนู", "ุงูุชุนุจูุฑ ุนู ุงุญุชูุงุฌ", "ุฅุดุจุงุน", "ุงููุฏุฉ"]
            }},
            aftercare: { title: 'ุงููุดูุฉ ููุง ุจุนุฏูุง', icon: 'fa-stars', sub: {
                "ุงูุงุทูุฆูุงู ๐": ["ุงููุตูู ูููุดูุฉ", "ุงูุชุฒุงูู", "ุญุถู ุจุนุฏู", "ูููุงุช ุญุจ", "ุจูุงุก ูุนุง", "ุฑุถุง", "ุนูุงูุฉ"]
            }},
            creativity: { title: 'ุงูุงุจุชูุงุฑ ูุงูุฃููุงุน', icon: 'fa-lightbulb', sub: {
                "ูุณุฑ ุงูุฑูุชูู ๐": ["ุชุบููุฑ ุงูููุงู", "ุฃูุถุงุน ุฌุฏูุฏุฉ", "ุฑูุงุฆุญ", "ููุณููู", "ุชูุงุนู ุณูุนู", "ููุงุฌุขุช"]
            }},
            boundaries: { title: 'ุงูุถูุงุจุท ุงูุดุฑุนูุฉ', icon: 'fa-shield-halved', sub: {
                "ุงูุณุชุฑ ูุงูุฎุตูุตูุฉ ๐ค": ["ุชุฌูุจ ุงูุญูุถ", "ุชุฌูุจ ุงูุฏุจุฑ", "ุนุฏู ุฅูุดุงุก ุงูุณุฑ", "ุชุฌูุจ ุงูุฅูุฑุงู", "ุงูุงูุชุฒุงู ุจุงูุณุชุฑ"]
            }},
            sexualhealth: { title: 'ุงูุตุญุฉ ุงููุณููููุฌูุฉ', icon: 'fa-dna', sub: {
                "ุงูุจุฏู ูุงููุฏุฑุฉ ๐ช": ["ูุฏุฑุฉ ุจุฏููุฉ", "ุบูุงุจ ุงูุฃูู", "ูุฑูููุงุช", "ุฑูุงุถุฉ ููููุฉ", "ุชุบุฐูุฉ", "ููู"]
            }},
            barriers: { title: 'ุงูุนูุงุฆู ูุงูุตุนูุจุงุช', icon: 'fa-ban', sub: {
                "ุชุญุฏูุงุช ููููุฉ ๐ช๏ธ": ["ุถุบูุท", "ุงูุดุบุงู ุจุงูุฃุจูุงุก", "ุชุนุจ", "ููู", "ุตูุฑุฉ ุงูุฌุณุฏ"]
            }},
            education: { title: 'ุงููุนู ูุงูุซูุงูุฉ', icon: 'fa-book-open', sub: {
                "ุงูููู ุงูุณูููููุฌู ๐ง": ["ุณูููููุฌูุฉ ุงูุฑุฌู", "ุณูููููุฌูุฉ ุงููุฑุฃุฉ", "ูุชุจ ุชูููุฉ", "ููุงุท ุงููุชุนุฉ"]
            }},
            spiritual: { title: 'ุงูุงุทูุฆูุงู ุงูุฑูุญู', icon: 'fa-mosque', sub: {
                "ุงูููุฉ ูุงูุนุจุงุฏุฉ ๐คฒ": ["ุฏุนุงุก ูุจู ุงูุนูุงูุฉ", "ุบุณู ูุดุชุฑู", "ุดูุฑ ุงููุนูุฉ", "ููุฉ ุงูุฅุนูุงู"]
            }}
        };

        // ุชูููุฏ ูุฑูุช ุงูุตุญุฉ
        function renderHealth() {
            const grid = document.getElementById('health-grid');
            grid.innerHTML = '';
            for (let key in healthData) {
                grid.innerHTML += `
                    <div class="card-item" onclick="openSubMenu('${key}', 'health')">
                        <i class="fas ${healthData[key].icon}" style="color:${healthData[key].color}"></i>
                        <span>${healthData[key].title}</span>
                    </div>`;
            }
        }

        // ุชูููุฏ ูุฑูุช ุงูุญููููุฉ
        function renderIntimacy() {
            const grid = document.getElementById('intimacy-grid');
            grid.innerHTML = '';
            for (let key in intimacyData) {
                grid.innerHTML += `
                    <div class="card-item" onclick="openSubMenu('${key}', 'intimacy')">
                        <i class="fas ${intimacyData[key].icon}" style="color:#800020"></i>
                        <span>${intimacyData[key].title}</span>
                    </div>`;
            }
        }

        function openSubMenu(mainKey, type) {
            const data = type === 'health' ? healthData[mainKey] : intimacyData[mainKey];
            let html = `<div style="text-align:right;">`;
            for (let subKey in data.sub) {
                html += `<button onclick="openForm('${mainKey}', '${subKey}', '${type}')" style="width:100%; padding:15px; margin-bottom:10px; border:1px solid #eee; border-radius:15px; background:white; font-family:'Tajawal'; text-align:right; cursor:pointer; display:flex; justify-content:space-between;">
                    <span>${subKey}</span> <i class="fas fa-chevron-left" style="color:var(--p2); font-size:12px; margin-top:4px;"></i>
                </button>`;
            }
            html += `</div>`;

            Swal.fire({ title: data.title, html: html, showConfirmButton: false, showCloseButton: true });
        }

        function openForm(mainKey, subKey, type) {
            const data = type === 'health' ? healthData[mainKey] : intimacyData[mainKey];
            const fields = data.sub[subKey];
            let formHtml = `
                <button class="swal-back-btn" onclick="openSubMenu('${mainKey}', '${type}')"><i class="fas fa-arrow-right"></i> ุฑุฌูุน</button>
                <div style="max-height:350px; overflow-y:auto; padding:5px;">`;
            
            fields.forEach((f, i) => {
                formHtml += `<label class="swal-label">${f}:</label><input id="v${i}" class="swal-custom-input" placeholder="ุฃุฏุฎูู ุงูุจูุงูุงุช...">`;
            });
            formHtml += `</div>`;

            Swal.fire({
                title: subKey,
                html: formHtml,
                confirmButtonText: 'ุญูุธ ูุชุญููู ุฐูู โจ',
                confirmButtonColor: type === 'health' ? '#eb2f96' : '#800020',
                preConfirm: () => {
                    let results = [];
                    fields.forEach((f, i) => {
                        results.push(f + ": " + document.getElementById('v' + i).value);
                    });
                    return { category: subKey, note: results.join(' | ') };
                }
            }).then(async (result) => {
                if (result.isConfirmed) {
                    saveAndAnalyze(result.value, type);
                }
            });
        }

        async function saveAndAnalyze(payload, type) {
            Swal.fire({ title: 'ุฌุงุฑู ุงูุญูุธ ูุงูุชุญููู...', didOpen: () => Swal.showLoading() });
            
            // ูุญุงูุงุฉ ุฅุฑุณุงู ูู Neon ู Knock ููุง ูู ููุฏู
            try {
                const response = await fetch('/api/save-health', { 
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify({ category: payload.category, note: payload.note, user_id: 1 }) 
                });
                const data = await response.json();
                
                openAIChat(type === 'health' ? 'ุทุจูุจุฉ ุฑูุฉ' : 'ูุณุชุดุงุฑุฉ ุงูุญููููุฉ');
                const container = document.getElementById('chat-messages');
                container.innerHTML += `<div class="msg msg-user">ุชู ุชุณุฌูู: ${payload.note}</div>`;
                container.innerHTML += `<div class="msg msg-ai">${data.advice || "ุชู ุชุญููู ุจูุงูุงุชูู ุจูุฌุงุญ. ุจูุงุกู ุนูู ุงููุฏุฎูุงุชุ ุญุงูุชูู ูุณุชูุฑุฉ ูููุตุญ ุจุงููุชุงุจุนุฉ ุงูุฏูุฑูุฉ."}</div>`;
                container.scrollTop = container.scrollHeight;
                Swal.fire('ุชู ุงูุญูุธ โจ', 'ูููููู ุฑุคูุฉ ุงูุชุญููู ูู ุงูุดุงุช', 'success');
            } catch (e) {
                Swal.fire('ุชู ุงูุญูุธ ูุญููุงู', 'ุชู ุญูุธ ุงูุจูุงูุงุช ูู ุงููุชุตูุญ ูุณูุชู ุงูุฑูุน ุนูุฏ ุชููุฑ ุงูุงุชุตุงู', 'info');
            }
        }

        function nav(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            document.getElementById('page-' + id).classList.add('active');
            el.classList.add('active');
        }

        function openAIChat(title) {
            document.getElementById('chat-title').innerText = title;
            document.getElementById('chat-overlay').style.display = 'flex';
        }

        function closeChat() { document.getElementById('chat-overlay').style.display = 'none'; }

        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value;
            if(!text) return;
            const container = document.getElementById('chat-messages');
            container.innerHTML += `<div class="msg msg-user">${text}</div>`;
            input.value = '';
            
            try {
                const res = await fetch('/api/raqqa-ai', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ prompt: text }) });
                const data = await res.json();
                container.innerHTML += `<div class="msg msg-ai">${data.reply || "ุฃูุง ูุนูู.. ุณุฃููู ุจุชุญููู ุงุณุชูุณุงุฑู ุจูุงุกู ุนูู ุณุฌูุงุชูู ุงูุตุญูุฉ."}</div>`;
            } catch(e) {
                container.innerHTML += `<div class="msg msg-ai">ุนุฐุฑุงูุ ุฃูุง ุฃุนูู ุญุงููุงู ุนูู ุชุญููู ุจูุงูุงุชูู ุงูุณุงุจูุฉุ ูู ูู ุณุคุงู ุขุฎุฑุ</div>`;
            }
            container.scrollTop = container.scrollHeight;
        }

        window.onload = () => {
            renderHealth();
            renderIntimacy();
        };
    </script>
</body>
</html>
