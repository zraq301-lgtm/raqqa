<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø±Ù‚Ø© - Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ·ÙˆØ±Ø©</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-pink: #e91e63;
            --soft-pink: #fce4ec;
            --ai-purple: #673ab7;
            --save-cyan: #00bcd4;
            --delete-red: #d32f2f;
        }

        body { font-family: 'Tajawal', sans-serif; background-color: #f8f9fa; color: #333; padding: 20px; line-height: 1.6; }
        .container { max-width: 850px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
        
        h1 { color: var(--primary-pink); text-align: center; margin-bottom: 30px; font-weight: 700; border-bottom: 2px solid var(--soft-pink); padding-bottom: 15px; }
        h2 { border-right: 5px solid var(--primary-pink); padding-right: 15px; margin-top: 35px; color: #444; font-size: 1.2rem; background: #fff5f8; padding: 10px; border-radius: 5px; }
        
        label { display: block; margin-bottom: 8px; font-weight: 700; color: #555; }
        input, textarea, select {
            width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-family: 'Tajawal'; transition: 0.3s;
        }
        input:focus, textarea:focus, select:focus { border-color: var(--primary-pink); outline: none; box-shadow: 0 0 8px rgba(233, 30, 99, 0.1); }
        
        button { color: white; padding: 14px 20px; border: none; border-radius: 10px; cursor: pointer; width: 100%; font-size: 1.1rem; font-weight: 700; transition: all 0.3s; margin-top: 5px; }
        button:active { transform: scale(0.98); }
        button:disabled { background-color: #ccc; cursor: not-allowed; }

        .btn-ai { background-color: var(--ai-purple); }
        .btn-save { background-color: var(--save-cyan); }
        .btn-delete { background-color: var(--delete-red); }

        .message { margin-top: 15px; padding: 15px; border-radius: 10px; display: none; font-size: 0.9rem; text-align: center; font-weight: bold; }
        .success { background-color: #e6fffa; color: #2c7a7b; border: 1px solid #b2f5ea; }
        .error { background-color: #fff5f5; color: #c53030; border: 1px solid #feb2b2; }
        .info { background-color: #ebf8ff; color: #2b6cb0; border: 1px solid #bee3f8; }
        
        #admin-content { display: none; }
        .loading-spinner { display: inline-block; width: 18px; height: 18px; border: 3px solid rgba(255,255,255,.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s linear infinite; vertical-align: middle; margin-left: 8px; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="container">
        <h1><i class="fas fa-heart"></i> Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø±Ù‚Ø©</h1>

        <div id="login-form">
            <h2><i class="fas fa-lock"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
            <input type="password" id="admin-password" placeholder="Ø£Ø¯Ø®Ù„ÙŠ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø·ÙˆØ±">
            <button class="btn-save" onclick="checkAuth()">Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
        </div>

        <div id="admin-content">
            
            <div class="card">
                <h2><i class="fas fa-robot"></i> ØªÙˆÙ„ÙŠØ¯ Ù…Ø­ØªÙˆÙ‰ Ø°ÙƒÙŠ (RAG System)</h2>
                <textarea id="ai-prompt" rows="3" placeholder="Ø§Ø³Ø£Ù„ÙŠ 'Ø±Ù‚Ø©' Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù†Øµ Ù…Ù† Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ..."></textarea>
                <button id="ai-btn" class="btn-ai" onclick="generateAIContent()">
                    <span id="ai-loader" style="display:none" class="loading-spinner"></span>
                    <i class="fas fa-magic"></i> Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù…Ù† Ø§Ù„Ù…ÙƒØªØ¨Ø©
                </button>
                <div id="ai-msg" class="message"></div>
            </div>

            <div class="card">
                <h2><i class="fas fa-paper-plane"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯ Ù„Ù€ Neon DB</h2>
                
                <label>Ø§Ù„Ù†Øµ (Ø£Ùˆ Ø§Ù„Ø±Ø¯ Ø§Ù„Ù…ÙˆÙ„Ø¯):</label>
                <textarea id="main-content" rows="6" placeholder="Ø§Ù„ØµÙ‚ÙŠ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø£Ùˆ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙŠØ¯ÙˆÙŠØ©..."></textarea>
                
                <label>Ø±ÙØ¹ ÙˆØ³Ø§Ø¦Ø· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                <input type="file" id="file-upload" accept="image/*,video/*">

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <label>Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø®ØµØµ:</label>
                        <select id="section-select">
                            <option value="bouh-display-1">Ø§Ù„Ù…Ø´Ø§Ø¹Ø± (emotions)</option>
                            <option value="bouh-display-2">Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ (society)</option>
                            <option value="bouh-display-3">Ø§Ù„ØµØ­Ø© (health)</option>
                            <option value="bouh-display-4">Ø§Ù„ÙÙ‚Ù‡ (fiqh)</option>
                            <option value="bouh-display-5">Ø§Ù„Ø­Ù…ÙŠÙ…ÙŠØ© (intimacy)</option>
                        </select>
                    </div>
                    <div>
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰:</label>
                        <select id="type-select">
                            <option value="Ù†ØµÙŠ">Ù†ØµÙŠ</option>
                            <option value="ØµÙˆØ±Ø©">ØµÙˆØ±Ø©</option>
                            <option value="ÙÙŠØ¯ÙŠÙˆ">ÙÙŠØ¯ÙŠÙˆ</option>
                        </select>
                    </div>
                </div>

                <button class="btn-save" onclick="saveToNeon()"><i class="fas fa-database"></i> Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                <div id="save-msg" class="message"></div>
            </div>

            <div class="card" style="border-top: 3px solid var(--delete-red);">
                <h2><i class="fas fa-trash-alt"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø°Ù</h2>
                <input type="number" id="delete-id" placeholder="Ø£Ø¯Ø®Ù„ÙŠ Ø±Ù‚Ù… ID Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ù„Ù„Ø­Ø°Ù">
                <button class="btn-delete" onclick="deleteFromNeon()">Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹</button>
                <div id="delete-msg" class="message"></div>
            </div>

        </div>
    </div>

    <script>
        const API_AI = '/api/gemini';
        const API_SAVE = '/api/save-post';
        const API_DELETE = '/api/delete-post';

        function checkAuth() {
            const p = document.getElementById('admin-password').value;
            if(p === 'zazo010988') {
                document.getElementById('login-form').style.display = 'none';
                document.getElementById('admin-content').style.display = 'block';
            } else {
                alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
            }
        }

        // 1. ÙˆØ¸ÙŠÙØ© Ø¬Ù„Ø¨ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
        async function generateAIContent() {
            const prompt = document.getElementById('ai-prompt').value;
            const btn = document.getElementById('ai-btn');
            const loader = document.getElementById('ai-loader');
            const msg = document.getElementById('ai-msg');

            if(!prompt) return showMsg(msg, 'ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø³Ø¤Ø§Ù„ Ø£ÙˆÙ„Ø§Ù‹', 'error');

            btn.disabled = true;
            loader.style.display = 'inline-block';
            showMsg(msg, 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ù…Ù„ÙØ§ØªÙƒ ÙˆØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ø¯ Ø§Ù„Ø±Ù‚ÙŠÙ‚...', 'info');

            try {
                const response = await fetch(API_AI, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ prompt: prompt })
                });
                const data = await response.json();
                
                if(data.reply) {
                    document.getElementById('main-content').value = data.reply;
                    document.getElementById('type-select').value = 'Ù†ØµÙŠ';
                    showMsg(msg, 'ØªÙ… Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­! Ø±Ø§Ø¬Ø¹ÙŠ Ø§Ù„Ù†Øµ Ø¨Ø§Ù„Ø£Ø³ÙÙ„ Ø«Ù… Ø§Ø­ÙØ¸ÙŠÙ‡.', 'success');
                } else {
                    showMsg(msg, 'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ø£Ø¬Ø¯ Ø¥Ø¬Ø§Ø¨Ø© Ø¯Ù‚ÙŠÙ‚Ø© ÙÙŠ Ø§Ù„Ù…ÙƒØªØ¨Ø©.', 'error');
                }
            } catch (err) {
                showMsg(msg, 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø³ÙŠØ±ÙØ± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.', 'error');
            } finally {
                btn.disabled = false;
                loader.style.display = 'none';
            }
        }

        // 2. ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ù†ÙŠÙˆÙ† (Ù†Øµ / ØµÙˆØ± / ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª)
        async function saveToNeon() {
            const contentText = document.getElementById('main-content').value;
            const fileInput = document.getElementById('file-upload');
            const section = document.getElementById('section-select').value;
            const type = document.getElementById('type-select').value;
            const msg = document.getElementById('save-msg');

            let finalContent = contentText;

            // Ø¥Ø°Ø§ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„ÙØŒ Ù†Ù‚ÙˆÙ… Ø¨ØªØ­ÙˆÙŠÙ„Ù‡ Ù„Ù€ Base64
            if (fileInput.files.length > 0) {
                showMsg(msg, 'Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù Ù„Ù„Ø±ÙØ¹...', 'info');
                const file = fileInput.files[0];
                finalContent = await toBase64(file);
            }

            if (!finalContent) return showMsg(msg, 'ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ù†Øµ Ø£Ùˆ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ù„Ù„Ø±ÙØ¹', 'error');

            try {
                const response = await fetch(API_SAVE, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        content: finalContent,
                        section: section,
                        type: type,
                        created_at: new Date().toISOString()
                    })
                });

                if (response.ok) {
                    showMsg(msg, 'âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Neon ÙˆØªÙˆØ¬ÙŠÙ‡Ù‡ Ù„Ù„Ù‚Ø³Ù… Ø§Ù„ØµØ­ÙŠØ­!', 'success');
                    document.getElementById('main-content').value = '';
                    fileInput.value = '';
                } else {
                    showMsg(msg, 'âŒ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.', 'error');
                }
            } catch (err) {
                showMsg(msg, 'Ø®Ø·Ø£ ØªÙ‚Ù†ÙŠ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ÙØ¸.', 'error');
            }
        }

        // 3. ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø­Ø°Ù
        async function deleteFromNeon() {
            const id = document.getElementById('delete-id').value;
            const msg = document.getElementById('delete-msg');
            if(!id) return showMsg(msg, 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ID Ø§Ù„Ù…Ù†Ø´ÙˆØ±', 'error');

            if(!confirm('Ù‡Ù„ Ø£Ù†ØªÙ Ù…ØªØ£ÙƒØ¯Ø© Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ')) return;

            try {
                const response = await fetch(`${API_DELETE}?id=${id}`, { method: 'DELETE' });
                if(response.ok) {
                    showMsg(msg, 'ğŸ—‘ï¸ ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.', 'success');
                } else {
                    showMsg(msg, 'Ø±Ù‚Ù… ID ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.', 'error');
                }
            } catch (err) {
                showMsg(msg, 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±.', 'error');
            }
        }

        // Ù…Ø³Ø§Ø¹Ø¯Ø©: ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†ØµÙŠØ© Base64
        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });

        function showMsg(el, text, type) {
            el.textContent = text;
            el.className = `message ${type}`;
            el.style.display = 'block';
            if(type !== 'info') setTimeout(() => el.style.display = 'none', 6000);
        }
    </script>
</body>
    </html>
