<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ·Ø¨ÙŠÙ‚ Ø±Ù‚Ø© | ÙˆØ¹ÙŠ ÙˆØ¥ÙŠÙ…Ø§Ù†</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@300;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root { 
            --p1: #ff85c0; --p2: #eb2f96; --purp: #722ed1; 
            --bg: #fffcfd; --glass: rgba(255, 255, 255, 0.9);
            --soft: #fff0f6;
        }
        body { font-family: 'Tajawal', sans-serif; background: linear-gradient(135deg, #fff5f8 0%, #f3e7ff 100%); margin: 0; padding-bottom: 90px; color: #444; min-height: 100vh; }
        
        .header { background: var(--glass); backdrop-filter: blur(10px); padding: 15px; text-align: center; position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid rgba(235, 47, 150, 0.1); }
        .logo { font-family: 'Amiri', serif; font-size: 28px; color: var(--p2); font-weight: bold; }

        .container { padding: 15px; max-width: 600px; margin: auto; }
        .page { display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .ai-action-btn {
            background: linear-gradient(45deg, var(--p2), var(--purp));
            color: white; border: none; width: 100%; padding: 16px; border-radius: 18px;
            font-weight: bold; margin-bottom: 25px; cursor: pointer; font-size: 15px;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            box-shadow: 0 4px 15px rgba(114, 46, 209, 0.2);
        }

        .grid-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .category-card { 
            background: var(--glass); border-radius: 22px; padding: 20px; text-align: center; 
            border: 1px solid rgba(255,255,255,0.7); box-shadow: 0 8px 25px rgba(0,0,0,0.05);
            transition: 0.3s; cursor: pointer;
        }
        .category-card:active { transform: scale(0.95); }
        .category-card i { font-size: 30px; margin-bottom: 12px; display: block; color: var(--p2); }
        .category-card span { font-size: 14px; font-weight: 700; color: #555; }

        #ai-result-display { display: none; background: white; border-radius: 20px; padding: 20px; margin-top: 20px; border-right: 5px solid var(--p2); box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
        #ai-result-display blockquote { font-family: 'Amiri'; font-size: 18px; color: #444; margin: 15px 0; background: #fff9fb; padding: 12px; border-radius: 10px; border: none; }

        .nav-bar { position: fixed; bottom: 0; width: 100%; background: var(--glass); backdrop-filter: blur(10px); display: flex; padding: 12px 0 25px; border-top: 1px solid #eee; z-index: 1000; }
        .nav-link { flex: 1; text-align: center; color: #bbb; text-decoration: none; font-size: 12px; display: flex; flex-direction: column; gap: 5px; }
        .nav-link.active { color: var(--p2); font-weight: bold; }
        .nav-link i { font-size: 24px; }
    </style>
</head>
<body>

    <header class="header"><div class="logo">Ø±Ù‚Ø©</div></header>

    <div class="container">
        <div id="page-emotions" class="page active">
            <button class="ai-action-btn" onclick="askFreeAI('Ù…Ø´Ø§Ø¹Ø±')">
                <i class="fas fa-magic"></i> ØªØ­Ù„ÙŠÙ„ Ù…Ø´Ø§Ø¹Ø± Ø­Ø± Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡
            </button>
            <div class="grid-container" id="emotions-grid"></div>
        </div>

        <div id="page-fiqh" class="page">
            <button class="ai-action-btn" onclick="askFreeAI('ÙÙ‚Ù‡')">
                <i class="fas fa-kaaba"></i> Ø§Ø³ØªØ´Ø§Ø±Ø© ÙÙ‚Ù‡ÙŠØ© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡
            </button>
            <div class="grid-container" id="fiqh-grid"></div>
        </div>

        <div id="ai-result-display"></div>
    </div>

    <nav class="nav-bar">
        <a href="#" class="nav-link active" onclick="nav('emotions', this)"><i class="fas fa-heart"></i><span>Ø§Ù„Ù…Ø´Ø§Ø¹Ø±</span></a>
        <a href="#" class="nav-link" onclick="nav('fiqh', this)"><i class="fas fa-book-open"></i><span>Ø§Ù„ÙÙ‚Ù‡</span></a>
    </nav>

    <script>
        // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ³ÙˆØ¹ÙŠØ© ÙƒØ§Ù…Ù„Ø©
        const emotionsData = [
            { title: "Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø¥ÙŠÙ…Ø§Ù†ÙŠ", icon: "fa-pray", items: ["Ù„Ø°Ø© Ø§Ù„Ù…Ù†Ø§Ø¬Ø§Ø© ğŸ¤²", "Ø®Ø´ÙˆØ¹ Ø§Ù„ØµÙ„Ø§Ø© âœ¨", "Ø·Ù…Ø£Ù†ÙŠÙ†Ø© Ø§Ù„Ø°ÙƒØ± ğŸ“¿", "Ø§Ù„Ø±Ø¶Ø§ Ø¨Ø§Ù„Ù‚Ø¶Ø§Ø¡ âœ…", "Ø§Ù„ÙŠÙ‚ÙŠÙ† ğŸ¯"] },
            { title: "Ø§Ù„Ø¥ÙŠÙ‚Ø§Ø¹ Ø§Ù„Ø­ÙŠÙˆÙŠ", icon: "fa-leaf", items: ["ØªÙ‚Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø²Ø§Ø¬ ğŸ¢", "ÙˆÙ‡Ù† Ø¬Ø³Ø¯ÙŠ ğŸ’¤", "Ø­Ø³Ø§Ø³ÙŠØ© Ù…ÙØ±Ø·Ø© ğŸŒ¸", "ØªØ¹Ø¨ Ø§Ù„Ø­ÙŠØ¶ ğŸ¥€"] },
            { title: "Ø§Ù„Ù‚Ù„Ø¨ Ø§Ù„Ø±Ø­ÙŠÙ…", icon: "fa-hands-holding-heart", items: ["Ø¨Ø± Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ† ğŸŒ³", "Ù…ÙˆØ¯Ø© Ø§Ù„Ø²ÙˆØ¬ â¤ï¸", "Ø±Ø­Ù…Ø© Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡ ğŸ£", "ØµÙ„Ø© Ø§Ù„Ø±Ø­Ù… ğŸ”—"] },
            { title: "Ø§Ù„Ø°Ø§Øª ÙˆØ§Ù„Ù†Ù…Ùˆ", icon: "fa-user-check", items: ["ÙØ®Ø± Ø¨Ø§Ù„Ø­Ø¬Ø§Ø¨ ğŸ§•", "Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø§Ù„Ø°Ø§Øª ğŸ‘‘", "Ø¬Ù‡Ø§Ø¯ Ø§Ù„Ù†ÙØ³ âš”ï¸", "ØªÙˆØ¨Ø© Ù†ØµÙˆØ­ âœ¨"] },
            { title: "Ø§Ù„ØµØ¨Ø± ÙˆØ§Ù„Ø§Ø¨ØªÙ„Ø§Ø¡", icon: "fa-gem", items: ["ØµØ¨Ø± Ø¬Ù…ÙŠÙ„ ğŸ’", "Ø¶ØºØ· Ù…Ø¬ØªÙ…Ø¹ÙŠ ğŸ‘ï¸", "Ø´Ø¹ÙˆØ± Ø¨Ø§Ù„Ø¸Ù„Ù… âš–ï¸", "Ø«Ù‚Ù„ Ø§Ù„Ø£Ù…Ø§Ù†Ø© ğŸ’"] },
            { title: "Ø§Ù„Ù†Ø¶Ø¬ ÙˆØ§Ù„ÙˆÙ‚Ø§Ø±", icon: "fa-hourglass-half", items: ["Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø´ÙŠØ¨ ğŸ•°ï¸", "ÙˆÙ‚Ø§Ø± Ø§Ù„Ø­ÙƒÙ…Ø© ğŸ’", "Ø²Ù‡Ø¯ Ø§Ù„Ø¯Ù†ÙŠØ§ ğŸƒ", "ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø³Ù†ÙŠÙ† ğŸ“š"] },
            { title: "Ø§Ù„Ù…Ø®Ø§ÙˆÙ ÙˆØ§Ù„Ø¸Ù„Ø§Ù„", icon: "fa-cloud-moon", items: ["Ø³ÙˆØ¡ Ø§Ù„Ø®Ø§ØªÙ…Ø© âŒ›", "Ø¯ÙŠÙ† Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡ ğŸ§’", "Ø®ÙˆÙ Ø§Ù„ÙÙ‚Ø¯ ğŸ’§", "Ù‚Ù„Ù‚ Ø§Ù„Ø±Ø²Ù‚ ğŸŒ¾"] },
            { title: "Ø§Ù„ØªØ¹Ø§ÙÙŠ ÙˆØ§Ù„ØªØ±Ù…ÙŠÙ…", icon: "fa-sparkles", items: ["Ø¬Ø¨Ø± Ø§Ù„Ù‚Ù„ÙˆØ¨ ğŸ©¹", "Ø§Ù†Ø´Ø±Ø§Ø­ Ø§Ù„ØµØ¯Ø± ğŸŒ¬ï¸", "ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø¹Ù‡Ø¯ âš¡", "Ø§Ø³ØªØ´ÙØ§Ø¡ Ø¨Ø§Ù„Ù‚Ø±Ø¢Ù† ğŸ“–"] },
            { title: "Ø§Ù„Ø·ÙÙ„Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©", icon: "fa-child", items: ["Ø¨Ø±Ø§Ø¡Ø© Ø§Ù„ÙØ·Ø±Ø© ğŸ­", "ÙØ¶ÙˆÙ„ Ø§Ù„Ù…Ø¹Ø±ÙØ© ğŸˆ", "Ø­Ø§Ø¬Ø© Ù„Ù„Ø£Ù…Ø§Ù† ğŸ§¸", "Ø¶Ø­Ùƒ Ø¹ÙÙˆÙŠ ğŸ‰"] },
            { title: "Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² ÙˆØ§Ù„Ø¹Ù…Ù„", icon: "fa-briefcase", items: ["Ø¨Ø±ÙƒØ© Ø§Ù„ÙˆÙ‚Øª â³", "Ø¥ØªÙ‚Ø§Ù† Ø§Ù„Ø¹Ù…Ù„ ğŸ¯", "ÙØ±Ø­Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² ğŸ†", "Ù†ÙØ¹ Ø§Ù„Ù†Ø§Ø³ ğŸ¤"] }
        ];

        const fiqhData = [
            { title: "Ø§Ù„Ø·Ù‡Ø§Ø±Ø©", icon: "fa-droplet", items: ["Ø³Ù†Ù† Ø§Ù„ÙØ·Ø±Ø© âœ¨", "ØµÙØ© Ø§Ù„ØºØ³Ù„ ğŸš¿", "Ø§Ù„ÙˆØ¶ÙˆØ¡ ğŸ’§", "Ø£Ø­ÙƒØ§Ù… Ø§Ù„Ù…Ø³Ø­ ğŸ‘Ÿ"] },
            { title: "Ø§Ù„ØµÙ„Ø§Ø©", icon: "fa-kaaba", items: ["Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© ğŸ•Œ", "Ø³Ø¬Ø¯Ø© Ø§Ù„Ø´ÙƒØ± ğŸ¤²", "Ù„Ø¨Ø§Ø³ Ø§Ù„ØµÙ„Ø§Ø© ğŸ§•", "ØµÙ„Ø§Ø© Ø§Ù„ÙˆØªØ± ğŸŒŒ"] },
            { title: "Ø§Ù„ØµÙŠØ§Ù…", icon: "fa-moon", items: ["ØµÙŠØ§Ù… Ø§Ù„ØªØ·ÙˆØ¹ ğŸŒ™", "Ù‚Ø¶Ø§Ø¡ Ù…Ø§ ÙØ§Øª ğŸ“…", "Ø³Ø­ÙˆØ± Ø§Ù„Ø¨Ø±ÙƒØ© ğŸ¥£"] },
            { title: "Ø§Ù„Ù‚Ø±Ø¢Ù†", icon: "fa-book-open", items: ["ØªÙ„Ø§ÙˆØ© ÙŠÙˆÙ…ÙŠØ© ğŸ“–", "ØªØ¯Ø¨Ø± Ø¢ÙŠØ© ğŸ’¡", "Ø­ÙØ¸ Ø³ÙˆØ±Ø© ğŸ’"] },
            { title: "Ø§Ù„ØªØ³Ø¨ÙŠØ­", icon: "fa-beads", items: ["Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­ â˜€ï¸", "Ø§Ù„Ø§Ø³ØªØºÙØ§Ø± ğŸ“¿", "Ø§Ù„Ø­ÙˆÙ‚Ù„Ø© âœ¨"] },
            { title: "Ø§Ù„Ø²ÙƒØ§Ø©", icon: "fa-hand-holding-heart", items: ["Ø²ÙƒØ§Ø© Ø§Ù„Ø­Ù„ÙŠ ğŸ’", "ØµØ¯Ù‚Ø© Ø§Ù„Ø³Ø± ğŸ¤«", "ÙƒÙØ§Ù„Ø© Ø§Ù„ÙŠØªÙŠÙ… ğŸ‘¶"] },
            { title: "Ø§Ù„Ù„Ø¨Ø§Ø³", icon: "fa-shirt", items: ["Ø´Ø±ÙˆØ· Ø§Ù„Ø­Ø¬Ø§Ø¨ ğŸ§•", "Ø§Ù„Ø²ÙŠÙ†Ø© Ø§Ù„Ù…Ø¨Ø§Ø­Ø© âœ¨", "Ø§Ù„ØªØ¬Ù…Ù„ Ù„Ù„Ø²ÙˆØ¬ ğŸ’„"] },
            { title: "Ø§Ù„Ø£Ø³Ø±Ø©", icon: "fa-house", items: ["Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø²ÙˆØ¬ ğŸ’", "ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡ ğŸ§’", "Ø¨Ø± Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ† ğŸŒ³"] },
            { title: "Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª", icon: "fa-handshake", items: ["Ø§Ù„Ø£Ù…Ø§Ù†Ø© ğŸ¤", "Ø§Ø¬ØªÙ†Ø§Ø¨ Ø§Ù„ØºÙŠØ¨Ø© ğŸš«", "ØµØ¯Ù‚ Ø§Ù„ÙˆØ¹Ø¯ âœ…"] },
            { title: "Ø§Ù„Ø³ÙØ±", icon: "fa-plane", items: ["Ù‚ØµØ± Ø§Ù„ØµÙ„Ø§Ø© âœˆï¸", "Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ø³ÙØ± ğŸŒ", "Ù…Ø­Ø±Ù… Ø§Ù„Ø³ÙØ± ğŸ›¡ï¸"] },
            { title: "Ø§Ù„Ù…Ø±Ø¶", icon: "fa-bed", items: ["Ø§Ù„Ø±Ù‚ÙŠØ© Ø§Ù„Ø´Ø±Ø¹ÙŠØ© ğŸ“–", "ØµÙ„Ø§Ø© Ø§Ù„Ù…Ø±ÙŠØ¶ ğŸª‘", "Ø£Ø¬Ø± Ø§Ù„ØµØ¨Ø± ğŸ©¹"] },
            { title: "Ø§Ù„Ø¬Ù†Ø§Ø¦Ø²", icon: "fa-box-archive", items: ["Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù‚Ø¨ÙˆØ± ğŸŒ‘", "ØªØ¹Ø²ÙŠØ© Ø§Ù„Ù…ØµØ§Ø¨ ğŸ¤"] },
            { title: "Ø§Ù„Ø£ÙŠÙ…Ø§Ù†", icon: "fa-file-signature", items: ["ÙƒÙØ§Ø±Ø© Ø§Ù„ÙŠÙ…ÙŠÙ† âœ‹", "ØµØ¯Ù‚ Ø§Ù„Ø­Ø¯ÙŠØ« ğŸ—£ï¸"] },
            { title: "Ø§Ù„Ø£Ø¶Ø­ÙŠØ©", icon: "fa-sheep", items: ["Ø³Ù†Ù† Ø§Ù„Ø¹ÙŠØ¯ ğŸ‰", "ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù„Ø­Ù… ğŸ¥©"] },
            { title: "Ø§Ù„Ø¹Ù„Ù…", icon: "fa-graduation-cap", items: ["Ø·Ù„Ø¨ Ø§Ù„Ø¹Ù„Ù… ğŸ“š", "Ø¢Ø¯Ø§Ø¨ Ø§Ù„Ù†ØµÙŠØ­Ø© ğŸ“¢"] }
        ];

        function initGrids() {
            const eGrid = document.getElementById('emotions-grid');
            emotionsData.forEach(cat => {
                const card = document.createElement('div');
                card.className = 'category-card';
                card.innerHTML = `<i class="fas ${cat.icon}"></i><span>${cat.title}</span>`;
                card.onclick = () => openPicker(cat.title, cat.items, 'Ù…Ø´Ø§Ø¹Ø±');
                eGrid.appendChild(card);
            });

            const fGrid = document.getElementById('fiqh-grid');
            fiqhData.forEach(cat => {
                const card = document.createElement('div');
                card.className = 'category-card';
                card.innerHTML = `<i class="fas ${cat.icon}"></i><span>${cat.title}</span>`;
                card.onclick = () => openPicker(cat.title, cat.items, 'ÙÙ‚Ù‡');
                fGrid.appendChild(card);
            });
        }

        function openPicker(title, items, categoryName) {
            let options = {};
            items.forEach(i => options[i] = i);
            Swal.fire({
                title: title,
                input: 'select',
                inputOptions: options,
                confirmButtonText: 'ØªØ­Ù„ÙŠÙ„ ÙˆØ­ÙØ¸ âœ¨',
                confirmButtonColor: '#eb2f96',
                showCancelButton: true
            }).then(res => {
                if(res.isConfirmed) {
                    processEntry(categoryName, res.value);
                }
            });
        }

        async function processEntry(cat, val) {
            const resultDiv = document.getElementById('ai-result-display');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„ Ù„Ù€ ${val}...`;

            try {
                // Ù…Ù†Ø·Ù‚ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Neon (ÙƒÙ…Ø§ ÙÙŠ Ù…Ù„Ù save-health.js)
                const saveRes = await fetch('/api/save-health', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ user_id: 1, category: cat, value: 0, note: val })
                });
                const saveData = await saveRes.json();

                // Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ (ÙƒÙ…Ø§ ÙÙŠ Ù…Ù„Ù raqqa-ai.js)
                const aiRes = await fetch('/api/raqqa-ai', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ prompt: `Ø¨ØµÙØªÙƒ Ø±Ù‚Ø©ØŒ Ù‚Ø¯Ù…ÙŠ Ù†ØµÙŠØ­Ø© Ø¯Ø§ÙØ¦Ø© Ø¨Ø®ØµÙˆØµ: ${cat} - ${val}` })
                });
                const aiData = await aiRes.json();

                resultDiv.innerHTML = `
                    <div style="font-weight:bold; color:var(--p2);">ØªØ­Ù„ÙŠÙ„ Ø±Ù‚Ø© Ù„Ù€ (${val}):</div>
                    <blockquote>${aiData.reply || saveData.advice}</blockquote>
                    <small style="color:#999;">ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø³Ø¬Ù„Ø§ØªÙƒÙ Ø¨Ù†Ø¬Ø§Ø­ âœ¨</small>
                `;
            } catch (e) {
                resultDiv.innerHTML = "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ù„ÙƒÙ† ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ù…Ø­Ø§ÙˆÙ„ØªÙƒÙ.";
            }
        }

        function askFreeAI(type) {
            Swal.fire({
                title: `Ø§Ø³Ø£Ù„ÙŠ Ø±Ù‚Ø© (${type})`,
                input: 'textarea',
                inputPlaceholder: 'Ø§ÙƒØªØ¨ÙŠ Ù…Ø§ ÙŠØ¬ÙˆÙ„ Ø¨Ø®Ø§Ø·Ø±ÙƒÙ...',
                confirmButtonText: 'Ø¥Ø±Ø³Ø§Ù„',
                confirmButtonColor: '#722ed1'
            }).then(res => {
                if(res.value) processEntry(type, res.value);
            });
        }

        function nav(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            document.getElementById('page-' + id).classList.add('active');
            el.classList.add('active');
            document.getElementById('ai-result-display').style.display = 'none';
        }

        window.onload = initGrids;
    </script>
</body>
</html>
