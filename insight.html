<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±Ù‚Ø© | Ø§Ù„Ø±ÙÙŠÙ‚Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@300;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root { 
            --p2: #eb2f96; --purp: #722ed1; --glass: rgba(255, 255, 255, 0.9);
            --bg-gradient: linear-gradient(135deg, #fff5f8 0%, #f3e7ff 100%);
        }
        body { 
            font-family: 'Tajawal', sans-serif; background: var(--bg-gradient); 
            margin: 0; padding-bottom: 90px; color: #444; min-height: 100vh;
            background-attachment: fixed;
        }
        .header { background: var(--glass); backdrop-filter: blur(10px); padding: 15px; text-align: center; position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid rgba(235, 47, 150, 0.1); }
        .logo { font-family: 'Amiri', serif; font-size: 28px; color: var(--p2); font-weight: bold; }
        .container { padding: 15px; max-width: 600px; margin: auto; }
        
        .page { display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Ø²Ø±Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .ai-entry-card {
            background: linear-gradient(45deg, var(--p2), var(--purp));
            color: white; padding: 20px; border-radius: 20px; text-align: center;
            margin-bottom: 20px; cursor: pointer; box-shadow: 0 8px 15px rgba(114, 46, 209, 0.2);
            transition: 0.3s;
        }
        .ai-entry-card:hover { transform: scale(1.02); }

        /* ØµÙØ­Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„Ø© */
        .ai-interface { background: white; border-radius: 25px; padding: 20px; min-height: 400px; position: relative; }
        .ai-tools-row { display: flex; justify-content: space-around; background: #f8f1ff; padding: 15px; border-radius: 20px; margin-bottom: 20px; }
        .tool-btn { border: none; background: white; color: var(--purp); width: 45px; height: 45px; border-radius: 12px; font-size: 18px; cursor: pointer; box-shadow: 0 3px 6px rgba(0,0,0,0.05); }
        
        /* Ø´Ø¨ÙƒØ© Ø§Ù„ÙƒØ±ÙˆØª */
        .grid-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .category-card { 
            background: var(--glass); border-radius: 22px; padding: 20px; text-align: center; 
            border: 1px solid rgba(255,255,255,0.7); box-shadow: 0 5px 15px rgba(0,0,0,0.04);
            cursor: pointer; transition: 0.3s;
        }
        .category-card i { font-size: 28px; margin-bottom: 10px; display: block; color: var(--p2); }
        .category-card span { font-size: 14px; font-weight: 700; }

        #ai-chat-box { height: 250px; overflow-y: auto; border: 1px dashed #eee; padding: 10px; margin-bottom: 15px; font-family: 'Amiri'; }

        .nav-bar { position: fixed; bottom: 0; width: 100%; background: var(--glass); backdrop-filter: blur(10px); display: flex; padding: 12px 0 25px; border-top: 1px solid #eee; z-index: 1000; }
        .nav-link { flex: 1; text-align: center; color: #bbb; text-decoration: none; font-size: 12px; display: flex; flex-direction: column; gap: 5px; }
        .nav-link.active { color: var(--p2); font-weight: bold; }
    </style>
</head>
<body>

    <header class="header"><div class="logo">Ø±Ù‚Ø©</div></header>

    <div class="container">
        <div id="page-emotions" class="page active">
            <div class="ai-entry-card" onclick="openAI('Ù…Ø´Ø§Ø¹Ø±')">
                <i class="fas fa-magic"></i>
                <h3>Ù…Ø­Ù„Ù„ Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ</h3>
                <p>ØªØ­Ø¯Ø«ÙŠØŒ ØµÙˆØ±ÙŠØŒ Ø£Ùˆ Ø§Ø±ÙØ¹ÙŠ Ù…Ù„ÙØ§Ù‹ Ù„Ù„ØªØ­Ù„ÙŠÙ„</p>
            </div>
            <div class="grid-container" id="emotions-grid"></div>
        </div>

        <div id="page-fiqh" class="page">
            <div class="ai-entry-card" onclick="openAI('ÙÙ‚Ù‡')">
                <i class="fas fa-kaaba"></i>
                <h3>Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„ÙÙ‚Ù‡ Ø§Ù„Ø°ÙƒÙŠ</h3>
                <p>Ø§Ø³Ø£Ù„ÙŠ Ø±Ù‚Ø© Ø¹Ù† Ø£ÙŠ Ø­ÙƒÙ… Ø´Ø±Ø¹ÙŠ Ø£Ùˆ ØªØ±Ø¨ÙˆÙŠ</p>
            </div>
            <div class="grid-container" id="fiqh-grid"></div>
        </div>

        <div id="page-ai-studio" class="page">
            <div class="ai-interface">
                <div class="ai-tools-row">
                    <button class="tool-btn" title="ØªØ­Ø¯Ø«ÙŠ" onclick="startMic()"><i class="fas fa-microphone"></i></button>
                    <button class="tool-btn" title="ÙƒØ§Ù…ÙŠØ±Ø§" onclick="openCam()"><i class="fas fa-camera"></i></button>
                    <button class="tool-btn" title="Ø±ÙØ¹ ØµÙˆØ±Ø©" onclick="uploadImg()"><i class="fas fa-image"></i></button>
                    <button class="tool-btn" title="Ø§Ù„Ø³Ø¬Ù„" onclick="showHistory()"><i class="fas fa-history"></i></button>
                </div>
                <div id="ai-chat-box">Ø§Ø¨Ø¯Ø¦ÙŠ Ø§Ù„ÙØ¶ÙØ¶Ø© Ù…Ø¹ Ø±Ù‚Ø© Ù‡Ù†Ø§...</div>
                <textarea id="ai-input" placeholder="Ø§ÙƒØªØ¨ÙŠ Ù‡Ù†Ø§..." style="width:100%; border-radius:15px; border:1px solid #ddd; padding:10px; height:80px;"></textarea>
                <button onclick="sendToAI()" style="width:100%; margin-top:10px; background:var(--p2); color:white; border:none; padding:12px; border-radius:15px; font-weight:bold;">Ø¥Ø±Ø³Ø§Ù„ ÙˆØªØ­Ù„ÙŠÙ„ âœ¨</button>
                <button onclick="nav('emotions')" style="width:100%; margin-top:10px; background:none; color:#999; border:none; cursor:pointer;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚ÙˆØ§Ø¦Ù…</button>
            </div>
        </div>
    </div>

    <nav class="nav-bar">
        <a href="#" class="nav-link active" id="nav-emotions" onclick="nav('emotions', this)"><i class="fas fa-heart"></i><span>Ø§Ù„Ù…Ø´Ø§Ø¹Ø±</span></a>
        <a href="#" class="nav-link" id="nav-fiqh" onclick="nav('fiqh', this)"><i class="fas fa-book-open"></i><span>Ø§Ù„ÙÙ‚Ù‡</span></a>
    </nav>

    <script>
        // --- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ³ÙˆØ¹ÙŠØ© (10 Ù…Ø´Ø§Ø¹Ø± + 15 ÙÙ‚Ù‡) ---
        const emotionsData = [
            { title: "Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø¥ÙŠÙ…Ø§Ù†ÙŠ", icon: "fa-pray", items: ["Ù„Ø°Ø© Ø§Ù„Ù…Ù†Ø§Ø¬Ø§Ø© ğŸ¤²", "Ø®Ø´ÙˆØ¹ Ø§Ù„ØµÙ„Ø§Ø© âœ¨", "Ø·Ù…Ø£Ù†ÙŠÙ†Ø© Ø§Ù„Ø°ÙƒØ± ğŸ“¿", "Ø­Ù„Ø§ÙˆØ© Ø§Ù„Ø¥ÙŠÙ…Ø§Ù† ğŸ¯", "Ø§Ù„Ø´ÙˆÙ‚ Ù„Ù„Ø­Ø¬ ğŸ•‹", "Ø§Ù„Ø±Ø¶Ø§ Ø¨Ø§Ù„Ù‚Ø¶Ø§Ø¡ âœ…", "Ø­Ø³Ù† Ø§Ù„Ø¸Ù† Ø¨Ø§Ù„Ù„Ù‡ ğŸŒˆ", "Ø§Ù„ÙŠÙ‚ÙŠÙ† Ø¨Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ğŸ¯"] },
            { title: "Ø§Ù„Ø¥ÙŠÙ‚Ø§Ø¹ Ø§Ù„Ø­ÙŠÙˆÙŠ", icon: "fa-leaf", items: ["ØªÙ‚Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø²Ø§Ø¬ ğŸ¢", "ÙˆÙ‡Ù† Ø¬Ø³Ø¯ÙŠ ğŸ’¤", "Ø­Ø³Ø§Ø³ÙŠØ© Ù…ÙØ±Ø·Ø© ğŸŒ¸", "ØªØ¹Ø¨ Ø§Ù„Ø­ÙŠØ¶ ğŸ¥€", "Ø·Ø§Ù‚Ø© Ø§Ù„ØµÙŠØ§Ù… ğŸŒ™", "Ù†Ø´Ø§Ø· Ø§Ù„ÙØ¬Ø± â˜€ï¸"] },
            { title: "Ø§Ù„Ù‚Ù„Ø¨ Ø§Ù„Ø±Ø­ÙŠÙ…", icon: "fa-hands-holding-heart", items: ["Ø¨Ø± Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ† ğŸŒ³", "Ù…ÙˆØ¯Ø© Ø§Ù„Ø²ÙˆØ¬ â¤ï¸", "Ø±Ø­Ù…Ø© Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡ ğŸ£", "ØµÙ„Ø© Ø§Ù„Ø±Ø­Ù… ğŸ”—", "Ø§Ù„Ø­Ø¨ ÙÙŠ Ø§Ù„Ù„Ù‡ ğŸ«‚", "Ø¹ÙÙˆ ÙˆØµÙØ­ ğŸ³ï¸"] },
            { title: "Ø§Ù„Ø°Ø§Øª ÙˆØ§Ù„Ù†Ù…Ùˆ", icon: "fa-user-check", items: ["ÙØ®Ø± Ø¨Ø§Ù„Ø­Ø¬Ø§Ø¨ ğŸ§•", "Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø§Ù„Ø°Ø§Øª ğŸ‘‘", "Ø¬Ù‡Ø§Ø¯ Ø§Ù„Ù†ÙØ³ âš”ï¸", "Ø±ØºØ¨Ø© ÙÙŠ Ø§Ù„Ø£Ø«Ø± ğŸƒ", "ØªÙˆØ¨Ø© Ù†ØµÙˆØ­ âœ¨", "ÙˆØ¹ÙŠ Ù†Ø§Ø¶Ø¬ ğŸ§ "] },
            { title: "Ø§Ù„ØµØ¨Ø± ÙˆØ§Ù„Ø§Ø¨ØªÙ„Ø§Ø¡", icon: "fa-gem", items: ["ØµØ¨Ø± Ø¬Ù…ÙŠÙ„ ğŸ’", "Ø´Ø¹ÙˆØ± Ø¨Ø§Ù„Ø¸Ù„Ù… âš–ï¸", "Ø«Ù‚Ù„ Ø§Ù„Ø£Ù…Ø§Ù†Ø© ğŸ’", "Ø®ÙˆÙ Ù…Ù† Ø§Ù„Ø±ÙŠØ§Ø¡ â„ï¸"] },
            { title: "Ø§Ù„Ù†Ø¶Ø¬ ÙˆØ§Ù„ÙˆÙ‚Ø§Ø±", icon: "fa-hourglass-half", items: ["Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø´ÙŠØ¨ ğŸ•°ï¸", "ÙˆÙ‚Ø§Ø± Ø§Ù„Ø­ÙƒÙ…Ø© ğŸ’", "Ø²Ù‡Ø¯ Ø§Ù„Ø¯Ù†ÙŠØ§ ğŸƒ", "Ø·Ù…Ø£Ù†ÙŠÙ†Ø© Ø§Ù„Ø®ØªØ§Ù… ğŸŒ…"] },
            { title: "Ø§Ù„Ù…Ø®Ø§ÙˆÙ ÙˆØ§Ù„Ø¸Ù„Ø§Ù„", icon: "fa-cloud-moon", items: ["Ø³ÙˆØ¡ Ø§Ù„Ø®Ø§ØªÙ…Ø© âŒ›", "Ù‚Ù„Ù‚ Ø§Ù„Ø±Ø²Ù‚ ğŸŒ¾", "Ø±Ù‡Ø¨Ø© Ø§Ù„Ù‚Ø¨Ø± ğŸŒ‘", "ÙˆØ³Ø§ÙˆØ³ Ø§Ù„Ù†ÙØ³ ğŸ’­"] },
            { title: "Ø§Ù„ØªØ¹Ø§ÙÙŠ ÙˆØ§Ù„ØªØ±Ù…ÙŠÙ…", icon: "fa-sparkles", items: ["Ø¬Ø¨Ø± Ø§Ù„Ù‚Ù„ÙˆØ¨ ğŸ©¹", "Ø§Ù†Ø´Ø±Ø§Ø­ Ø§Ù„ØµØ¯Ø± ğŸŒ¬ï¸", "Ù…Ø³Ø§Ù…Ø­Ø© Ø§Ù„Ù…Ø§Ø¶ÙŠ âœ¨", "Ø§Ø³ØªØ´ÙØ§Ø¡ Ø¨Ø§Ù„Ù‚Ø±Ø¢Ù† ğŸ“–"] },
            { title: "Ø§Ù„Ø·ÙÙ„Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©", icon: "fa-child", items: ["Ø¨Ø±Ø§Ø¡Ø© Ø§Ù„ÙØ·Ø±Ø© ğŸ­", "ÙØ¶ÙˆÙ„ Ø§Ù„Ù…Ø¹Ø±ÙØ© ğŸˆ", "Ø­Ø§Ø¬Ø© Ù„Ù„Ø£Ù…Ø§Ù† ğŸ§¸", "Ø¶Ø­Ùƒ Ø¹ÙÙˆÙŠ ğŸ‰"] },
            { title: "Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² ÙˆØ§Ù„Ø¹Ù…Ù„", icon: "fa-briefcase", items: ["Ø¨Ø±ÙƒØ© Ø§Ù„ÙˆÙ‚Øª â³", "Ø¥ØªÙ‚Ø§Ù† Ø§Ù„Ø¹Ù…Ù„ ğŸ¯", "Ù†ÙØ¹ Ø§Ù„Ù†Ø§Ø³ ğŸ¤", "Ø¯Ø¹ÙˆØ© Ø¥Ù„Ù‰ Ø§Ù„Ù„Ù‡ ğŸ“¢"] }
        ];

        const fiqhData = [
            { title: "Ø§Ù„Ø·Ù‡Ø§Ø±Ø©", icon: "fa-droplet", items: ["Ø³Ù†Ù† Ø§Ù„ÙØ·Ø±Ø© âœ¨", "ØµÙØ© Ø§Ù„ØºØ³Ù„ ğŸš¿", "Ø§Ù„ÙˆØ¶ÙˆØ¡ Ø§Ù„Ø¬Ù…Ø§Ù„ÙŠ ğŸ’§", "Ø£Ø­ÙƒØ§Ù… Ø§Ù„Ù…Ø³Ø­ ğŸ‘Ÿ"] },
            { title: "Ø§Ù„ØµÙ„Ø§Ø©", icon: "fa-kaaba", items: ["Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© ğŸ•Œ", "Ø§Ù„Ø³Ø¬Ø¯Ø© ğŸ¤²", "Ù„Ø¨Ø§Ø³ Ø§Ù„ØµÙ„Ø§Ø© ğŸ§•", "ØµÙ„Ø§Ø© Ø§Ù„ÙˆØªØ± ğŸŒŒ"] },
            { title: "Ø§Ù„ØµÙŠØ§Ù…", icon: "fa-moon", items: ["ØµÙŠØ§Ù… Ø§Ù„Ø§Ø«Ù†ÙŠÙ† ğŸŒ™", "Ù‚Ø¶Ø§Ø¡ Ø§Ù„ÙØ§Ø¦Øª ğŸ“…", "Ø³Ø­ÙˆØ± Ø§Ù„Ø¨Ø±ÙƒØ© ğŸ¥£"] },
            { title: "Ø§Ù„Ù‚Ø±Ø¢Ù†", icon: "fa-book-open", items: ["ØªÙ„Ø§ÙˆØ© ÙŠÙˆÙ…ÙŠØ© ğŸ“–", "ØªØ¯Ø¨Ø± Ø¢ÙŠØ© ğŸ’¡", "Ø­ÙØ¸ Ø¬Ø¯ÙŠØ¯ ğŸ’"] },
            { title: "Ø§Ù„ØªØ³Ø¨ÙŠØ­", icon: "fa-beads", items: ["Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­ â˜€ï¸", "Ø§Ø³ØªØºÙØ§Ø± ğŸ“¿", "Ø­ÙˆÙ‚Ù„Ø© âœ¨"] },
            { title: "Ø§Ù„Ø²ÙƒØ§Ø©", icon: "fa-hand-holding-heart", items: ["Ø²ÙƒØ§Ø© Ø§Ù„Ø­Ù„ÙŠ ğŸ’", "ØµØ¯Ù‚Ø© Ø§Ù„Ø³Ø± ğŸ¤«"] },
            { title: "Ø§Ù„Ù„Ø¨Ø§Ø³ ÙˆØ§Ù„Ø²ÙŠÙ†Ø©", icon: "fa-shirt", items: ["Ø§Ù„Ø­Ø¬Ø§Ø¨ Ø§Ù„Ø´Ø±Ø¹ÙŠ ğŸ§•", "Ø²ÙŠÙ†Ø© Ø§Ù„ÙˆØ¬Ù‡ âœ¨", "Ø§Ù„Ø¹Ø·ÙˆØ± ğŸŒ¸"] },
            { title: "ÙÙ‚Ù‡ Ø§Ù„Ø£Ø³Ø±Ø©", icon: "fa-house", items: ["Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø²ÙˆØ¬ ğŸ’", "ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡ ğŸ§’"] },
            { title: "Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª", icon: "fa-handshake", items: ["ØµØ¯Ù‚ Ø§Ù„Ø­Ø¯ÙŠØ« ğŸ—£ï¸", "Ø§Ù„Ø£Ù…Ø§Ù†Ø© ğŸ¤"] },
            { title: "ÙÙ‚Ù‡ Ø§Ù„Ø³ÙØ±", icon: "fa-plane", items: ["Ù‚ØµØ± Ø§Ù„ØµÙ„Ø§Ø© âœˆï¸", "Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ø³ÙØ± ğŸŒ"] },
            { title: "Ø§Ù„Ø·Ø¨ Ø§Ù„Ù†Ø¨ÙˆÙŠ", icon: "fa-seedling", items: ["Ø§Ù„Ø­Ø¬Ø§Ù…Ø© ğŸ©¸", "Ø§Ù„Ø¹Ø³Ù„ ÙˆØ§Ù„Ø´ÙØ§Ø¡ ğŸ¯"] },
            { title: "Ø£Ø­ÙƒØ§Ù… Ø§Ù„ÙŠØªÙŠÙ…", icon: "fa-child-reaching", items: ["ÙƒÙØ§Ù„Ø© Ø§Ù„ÙŠØªÙŠÙ… ğŸ‘¶", "Ø§Ù„Ù…Ù„Ø§Ø·ÙØ© ğŸ¬"] },
            { title: "Ø§Ù„Ø¬Ù†Ø§Ø¦Ø²", icon: "fa-box-archive", items: ["Ø§Ù„ØµØ¨Ø± Ø¹Ù†Ø¯ Ø§Ù„ÙÙ‚Ø¯ ğŸŒ‘", "Ø§Ù„Ø¯Ø¹Ø§Ø¡ Ù„Ù„Ù…ÙŠØª ğŸ¤²"] },
            { title: "Ø§Ù„Ø¹ÙŠØ¯ÙŠÙ†", icon: "fa-star-and-crescent", items: ["Ø³Ù†Ù† Ø§Ù„Ø¹ÙŠØ¯ ğŸ‰", "Ø§Ù„Ø£Ø¶Ø­ÙŠØ© ğŸ¥©"] },
            { title: "Ø·Ù„Ø¨ Ø§Ù„Ø¹Ù„Ù…", icon: "fa-graduation-cap", items: ["Ø¢Ø¯Ø§Ø¨ Ø§Ù„Ø¹Ù„Ù… ğŸ“š", "Ù†Ø´Ø±Ù‡ Ù„Ù„Ù†Ø§Ø³ ğŸ“¢"] }
        ];

        let currentCat = "Ù…Ø´Ø§Ø¹Ø±";

        function init() {
            renderGrid('emotions-grid', emotionsData, 'Ù…Ø´Ø§Ø¹Ø±');
            renderGrid('fiqh-grid', fiqhData, 'ÙÙ‚Ù‡');
        }

        function renderGrid(id, data, cat) {
            const grid = document.getElementById(id);
            data.forEach(item => {
                const card = document.createElement('div');
                card.className = 'category-card';
                card.innerHTML = `<i class="fas ${item.icon}"></i><span>${item.title}</span>`;
                card.onclick = () => openPicker(item.title, item.items, cat);
                grid.appendChild(card);
            });
        }

        function openPicker(title, items, cat) {
            let opts = {}; items.forEach(i => opts[i] = i);
            Swal.fire({
                title: title,
                input: 'select',
                inputOptions: opts,
                confirmButtonText: 'ØªØ­Ù„ÙŠÙ„ ÙˆØ­ÙØ¸ âœ¨',
                confirmButtonColor: '#eb2f96'
            }).then(r => { if(r.isConfirmed) processAction(cat, r.value); });
        }

        function openAI(cat) {
            currentCat = cat;
            nav('ai-studio');
            document.getElementById('ai-chat-box').innerHTML = `Ø£Ù†Ø§ Ø±Ù‚Ø©ØŒ Ù…Ø³ØªØ´Ø§Ø±ØªÙƒÙ ÙÙŠ Ø§Ù„Ù€ ${cat}. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒÙ Ø§Ù„Ø¢Ù†ØŸ`;
        }

        async function processAction(cat, val) {
            const chat = document.getElementById('ai-chat-box');
            chat.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Ø±Ù‚Ø© ØªÙƒØªØ¨ Ù„ÙƒÙ...`;
            
            try {
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù†ÙŠÙˆÙ† (Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø£ØµÙ„ÙŠ)
                const saveRes = await fetch('/api/save-health', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ user_id: 1, category: cat, value: 0, note: val })
                });
                const saveData = await saveRes.json();

                // Ø¬Ù„Ø¨ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡
                const aiRes = await fetch('/api/raqqa-ai', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ prompt: `Ø¨ØµÙØªÙƒ Ø±Ù‚Ø©ØŒ Ø­Ù„Ù„ÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø© Ù„Ù„Ù…Ø±Ø£Ø© Ø§Ù„Ù…Ø³Ù„Ù…Ø©: ${cat} - ${val}. Ø§Ø°ÙƒØ±Ù Ø¢ÙŠØ© Ø£Ùˆ Ø­Ø¯ÙŠØ«Ø§Ù‹.` })
                });
                const aiData = await aiRes.json();

                chat.innerHTML = `<div><strong>ØªØ­Ù„ÙŠÙ„ÙŠ Ù„Ù€ (${val}):</strong><br>${aiData.reply || saveData.advice}</div>`;
                saveToLocalHistory(val, aiData.reply);
            } catch (e) {
                chat.innerHTML = "ØªÙ… Ø­ÙØ¸ Ø§Ø®ØªÙŠØ§Ø±ÙƒÙ Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª âœ¨";
            }
        }

        function sendToAI() {
            const input = document.getElementById('ai-input');
            if(input.value) { processAction(currentCat, input.value); input.value = ''; }
        }

        function nav(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + id).classList.add('active');
            if(el) {
                document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
                el.classList.add('active');
            }
        }

        // Ø£Ø¯ÙˆØ§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø¯Ø§Ø®Ù„ ØµÙØ­Ø© Ø§Ù„Ø°ÙƒØ§Ø¡
        function startMic() { Swal.fire('Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†', 'Ø£Ù†Ø§ Ø£Ø³Ù…Ø¹ÙƒÙ Ø§Ù„Ø¢Ù†.. ØªØ­Ø¯Ø«ÙŠ Ø¨Ø±Ø§Ø­Ø©', 'info'); }
        function openCam() { Swal.fire('Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§', 'Ø§Ù„ØªÙ‚Ø·ÙŠ ØµÙˆØ±Ø© Ù„Ù…Ø§ ÙŠØ¹Ø¨Ø± Ø¹Ù† Ø­Ø§Ù„ÙƒÙ Ù„ØªØ¯Ø¨Ø±ÙŠ ÙÙŠÙ‡', 'info'); }
        function uploadImg() { Swal.fire('Ø±ÙØ¹ Ù…Ù„Ù', 'Ø§Ø®ØªØ§Ø±ÙŠ ØµÙˆØ±Ø© Ù„ØªØ­Ù„ÙŠÙ„Ù‡Ø§ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ', 'info'); }
        
        function saveToLocalHistory(val, reply) {
            let hist = JSON.parse(localStorage.getItem('raqqa_history') || '[]');
            hist.push({date: new Date().toLocaleDateString(), val, reply});
            localStorage.setItem('raqqa_history', JSON.stringify(hist));
        }

        function showHistory() {
            let hist = JSON.parse(localStorage.getItem('raqqa_history') || '[]');
            let html = hist.map(h => `<div style="text-align:right; border-bottom:1px solid #eee; padding:10px;"><b>${h.val}</b><br><small>${h.reply}</small></div>`).join('');
            Swal.fire({ title: 'Ø³Ø¬Ù„ Ù…Ø­Ø§Ø¯Ø«Ø§ØªÙƒÙ', html: html || 'Ø§Ù„Ø³Ø¬Ù„ ÙØ§Ø±Øº Ø­Ø§Ù„ÙŠØ§Ù‹' });
        }

        window.onload = init;
    </script>
</body>
</html>
