<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>رقة - عالمكِ الذكي</title>
    <link href="https://fonts.googleapis.com/css2?family=Aref+Ruqaa:wght@700&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root { --raqqa-pink: #ad1457; --soft-pink: #fce4ec; --bg: #fffafb; --text: #444; }
        body { font-family: 'Tajawal', sans-serif; background: var(--bg); margin: 0; padding-bottom: 90px; color: var(--text); }
        
        header { background: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000; }
        .logo { font-family: 'Aref Ruqaa'; font-size: 1.8rem; color: var(--raqqa-pink); }
        .fb-link { color: #1877f2; font-size: 1.8rem; text-decoration: none; }

        /* ترحيب الصفحة الرئيسية */
        .welcome-hero { height: 80vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; background: radial-gradient(circle, #fff, var(--soft-pink)); }
        .welcome-hero h1 { font-family: 'Aref Ruqaa'; font-size: 3rem; color: var(--raqqa-pink); margin: 0; }
        .welcome-hero p { font-size: 1.2rem; color: #666; font-style: italic; max-width: 300px; line-height: 1.6; }

        .page { display: none; padding: 15px; animation: fadeIn 0.5s ease; }
        .active-page { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* همسة القسم */
        .hamssa-box { background: white; border-right: 4px solid var(--raqqa-pink); padding: 15px; border-radius: 10px; margin-bottom: 20px; font-weight: bold; color: var(--raqqa-pink); box-shadow: 0 4px 12px rgba(0,0,0,0.03); font-size: 0.9rem; }

        /* المتابعات الذكية (11 متابعة) */
        .health-dashboard { background: white; border-radius: 20px; padding: 15px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); }
        .trackers-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .tracker-card { display: flex; flex-direction: column; align-items: center; background: #fff; border: 1px solid #ffeef2; border-radius: 12px; padding: 10px 5px; cursor: pointer; transition: 0.2s; position: relative; }
        .tracker-card i { font-size: 1.3rem; color: var(--raqqa-pink); margin-bottom: 5px; }
        .tracker-card span { font-size: 0.65rem; font-weight: bold; text-align: center; }
        .status-dot { width: 8px; height: 8px; background: #ff4d4d; border-radius: 50%; position: absolute; top: 5px; right: 5px; display: none; }
        .has-issue .status-dot { display: block; }

        /* أزرار الذكاء الاصطناعي */
        .ai-expert-btn { width: 100%; padding: 12px; margin: 10px 0; border-radius: 12px; border: none; background: linear-gradient(45deg, var(--raqqa-pink), #ff5a92); color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }

        /* المنشورات */
        .post-card { background: white; border-radius: 15px; padding: 15px; margin-bottom: 15px; border: 1px solid #eee; }
        .post-media video, .post-media img { width: 100%; border-radius: 10px; margin-bottom: 10px; }
        .post-actions { display: flex; justify-content: space-around; border-top: 1px solid #eee; padding-top: 10px; }
        .action-btn { background: none; border: none; color: #777; font-size: 0.85rem; cursor: pointer; display: flex; align-items: center; gap: 5px; transition: 0.3s; }
        .action-btn.active { color: var(--raqqa-pink); }

        nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 12px 0; box-shadow: 0 -5px 15px rgba(0,0,0,0.05); z-index: 1000; }
        .nav-link { color: #ccc; text-align: center; font-size: 0.65rem; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        .nav-link.active-nav { color: var(--raqqa-pink); font-weight: bold; }
        .nav-link i { font-size: 1.4rem; margin-bottom: 4px; }
    </style>
</head>
<body>

<header>
    <a href="https://www.facebook.com/profile.php?id=61571056531349" target="_blank" class="fb-link"><i class="fab fa-facebook"></i></a>
    <div class="logo">رقة</div>
    <div style="width: 32px;"></div>
</header>

<main>
    <section id="home" class="page active-page">
        <div class="welcome-hero">
            <h1>رقة</h1>
            <p>"أهلاً بكِ في عالمكِ الخاص، أنتِ اليوم أجمل.. نحن هنا لنرافقكِ في كل تفاصيلكِ."</p>
        </div>
    </section>

    <section id="emotions" class="page">
        <div class="hamssa-box">همسة المشاعر: "قلبكِ يستحق الراحة، عبري عن ما بداخلكِ فكلماتكِ شفاء."</div>
        <button class="ai-expert-btn" onclick="askAI('حللي حالتي المزاجية بناءً على تاريخي اليوم')"><i class="fas fa-brain"></i> محلل السعادة والذكاء الوجداني</button>
        <div id="display-emotions"></div>
    </section>

    <section id="society" class="page">
        <div class="hamssa-box">همسة المجتمع: "كوني ملهمة، كوني قوية، فالمجتمع يزهر بوجودكِ المؤثر."</div>
        <button class="ai-expert-btn" onclick="askAI('كيف أتعامل مع الضغوط الاجتماعية الحالية؟')"><i class="fas fa-users"></i> مستشار العلاقات الذكي</button>
        <div id="display-society"></div>
    </section>

    <section id="health" class="page">
        <div class="hamssa-box">همسة الصحة: "جسدكِ أمانة، اعتني به ليزهر شبابكِ دائماً."</div>
        <div class="health-dashboard">
            <h4 style="text-align: center; color: var(--raqqa-pink); margin-top: 0;">نظام المتابعة العالمي (11 مؤشر)</h4>
            <div class="trackers-grid" id="trackersGrid"></div>
        </div>
        <button class="ai-expert-btn" onclick="askAI('حلل مؤشراتي الصحية الحالية وأعطني نصيحة طبية')"><i class="fas fa-stethoscope"></i> طبيب رقة الافتراضي</button>
        <div id="display-health"></div>
    </section>

    <section id="fiqh" class="page">
        <div class="hamssa-box">همسة الفقه: "العلم نور، والتفقه في الدين رفعة لكِ في الدنيا والآخرة."</div>
        <button class="ai-expert-btn" onclick="askAI('أبحث في ملفات الفقه عن إجابة لمسألتي')"><i class="fas fa-book-open"></i> الباحث الفقهي الذكي</button>
        <div id="display-fiqh"></div>
    </section>

    <section id="intimacy" class="page">
        <div class="hamssa-box">همسة الحميمية: "السعادة الزوجية تبدأ من الوعي والاهتمام بأدق التفاصيل."</div>
        <button class="ai-expert-btn" onclick="askAI('نصيحة ذكية لتعزيز الروابط العاطفية')"><i class="fas fa-heart"></i> مرشد السعادة الحميمية</button>
        <div id="display-intimacy"></div>
    </section>
</main>

<nav>
    <a onclick="switchTab('home', this)" class="nav-link active-nav"><i class="fas fa-house"></i>الرئيسية</a>
    <a onclick="switchTab('emotions', this)" class="nav-link"><i class="fas fa-face-smile"></i>المشاعر</a>
    <a onclick="switchTab('society', this)" class="nav-link"><i class="fas fa-users-viewfinder"></i>المجتمع</a>
    <a onclick="switchTab('health', this)" class="nav-link"><i class="fas fa-heart-pulse"></i>الصحة</a>
    <a onclick="switchTab('fiqh', this)" class="nav-link"><i class="fas fa-mosque"></i>الفقه</a>
    <a onclick="switchTab('intimacy', this)" class="nav-link"><i class="fas fa-venus"></i>الحميمية</a>
</nav>

<script>
    // نظام الـ 11 متابعة (مع تفعيل حالة المشكلة بناءً على الذكاء)
    const trackers = [
        { id: 'cycle', name: 'الدورة', icon: 'fa-droplet', issue: true },
        { id: 'water', name: 'الماء', icon: 'fa-glass-water', issue: false },
        { id: 'sleep', name: 'النوم', icon: 'fa-bed', issue: true },
        { id: 'mood', name: 'السعادة', icon: 'fa-face-laugh-beam', issue: false },
        { id: 'weight', name: 'الوزن', icon: 'fa-weight-scale', issue: true },
        { id: 'skin', name: 'البشرة', icon: 'fa-sparkles', issue: true },
        { id: 'steps', name: 'الخطوات', icon: 'fa-shoe-prints', issue: false },
        { id: 'pills', name: 'الفيتامين', icon: 'fa-pills', issue: true },
        { id: 'preg', name: 'الحمل', icon: 'fa-baby', issue: false },
        { id: 'mental', name: 'التوتر', icon: 'fa-brain', issue: true },
        { id: 'heart', name: 'النبض', icon: 'fa-heart-pulse', issue: true }
    ];

    function initTrackers() {
        const grid = document.getElementById('trackersGrid');
        grid.innerHTML = trackers.map(t => `
            <div class="tracker-card ${t.issue ? 'has-issue' : ''}" onclick="openTracker('${t.name}')">
                <div class="status-dot"></div>
                <i class="fas ${t.icon}"></i>
                <span>${t.name}</span>
            </div>
        `).join('');
    }

    async function openTracker(name) {
        const { value: val } = await Swal.fire({
            title: `متابعة ${name}`,
            input: 'text',
            inputPlaceholder: 'أدخلي القيمة أو الحالة...',
            confirmButtonText: 'تحليل ذكي',
            confirmButtonColor: '#ad1457'
        });
        if (val) askAI(`مؤشر ${name} لدي هو ${val}، هل هذا طبيعي؟`);
    }

    async function askAI(prompt) {
        Swal.fire({ title: 'رقة تفكر...', didOpen: () => Swal.showLoading() });
        try {
            const res = await fetch('/api/raqqa-ai', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt })
            });
            const data = await res.json();
            Swal.fire({ title: 'رقة تقول لكِ', text: data.reply, icon: 'info', confirmButtonColor: '#ad1457' });
        } catch (e) { Swal.fire('خطأ', 'حاولي لاحقاً يا رقيقة', 'error'); }
    }

    async function loadNeonPosts(section, containerId) {
        const container = document.getElementById(containerId);
        container.innerHTML = '<center><i class="fas fa-spinner fa-spin"></i> جاري التحميل...</center>';
        try {
            const res = await fetch('/api/get-posts');
            const data = await res.json();
            // تصفية المحتوى بناءً على حقل section في نيون (bouh-display-1, bouh-display-2..)
            const filtered = data.posts.filter(p => p.section === section);
            
            container.innerHTML = filtered.map(p => `
                <div class="post-card">
                    <div class="post-media">${renderMedia(p.media_url || '')}</div>
                    <p>${p.content}</p>
                    <div class="post-actions">
                        <button class="action-btn" onclick="toggleLike(this)"><i class="fas fa-heart"></i> إعجاب</button>
                        <button class="action-btn" onclick="openComments('${p.id}')"><i class="fas fa-comment"></i> تعليق</button>
                        <button class="action-btn" onclick="sharePost('${encodeURIComponent(p.content)}')"><i class="fas fa-share-nodes"></i> مشاركة</button>
                    </div>
                </div>
            `).join('');
        } catch (e) { container.innerHTML = 'حدث خطأ في جلب البيانات'; }
    }

    function renderMedia(url) {
        if (!url) return '';
        if (url.includes('.mp4') || url.includes('video')) return `<video src="${url}" controls style="width:100%"></video>`;
        return `<img src="${url}" style="width:100%">`;
    }

    function toggleLike(btn) { btn.classList.toggle('active'); }

    function openComments(id) {
        Swal.fire({
            title: 'التعليقات',
            input: 'textarea',
            inputPlaceholder: 'اكتبي تعليقكِ الرقيق هنا...',
            confirmButtonText: 'نشر',
            footer: '<small>سيتم حفظ تعليقكِ في قاعدة البيانات</small>'
        });
    }

    function sharePost(text) {
        if (navigator.share) {
            navigator.share({ title: 'من تطبيق رقة', text: decodeURIComponent(text), url: window.location.href });
        } else {
            Swal.fire('نسخ الرابط', 'تم نسخ المحتوى لمشاركته يدوياً', 'success');
        }
    }

    function switchTab(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
        document.getElementById(id).classList.add('active-page');
        document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active-nav'));
        el.classList.add('active-nav');

        // الربط مع الصورة: 1=مشاعر، 4=مجتمع، 2=صحة
        const map = { emotions: 'bouh-display-1', society: 'bouh-display-4', health: 'bouh-display-2', fiqh: 'bouh-display-3', intimacy: 'bouh-display-5' };
        if (map[id]) loadNeonPosts(map[id], `display-${id}`);
    }

    window.onload = initTrackers;
</script>
</body>
    </html>
