<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ·Ø¨ÙŠÙ‚ Ø±Ù‚Ø© | Ø¹Ø§Ù„Ù…ÙƒÙ Ø§Ù„Ø®Ø§Øµ</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root { 
            --p1: #ff85c0; --p2: #eb2f96; --purp: #722ed1; 
            --bg: #fffcfd; --soft: #fff0f6; --gold: #faad14;
            --glass: rgba(255, 255, 255, 0.9);
        }
        body { font-family: 'Tajawal', sans-serif; background: var(--bg); margin: 0; padding-bottom: 100px; color: #444; overflow-x: hidden; }
        
        .top-nav { background: var(--glass); backdrop-filter: blur(10px); padding: 15px 20px; display: flex; justify-content: center; align-items: center; box-shadow: 0 2px 15px rgba(0,0,0,0.05); position: sticky; top:0; z-index:1001; }
        .logo-text { font-weight: 800; color: var(--p2); font-size: 26px; }

        .search-container { padding: 10px 15px; background: var(--bg); position: sticky; top: 60px; z-index: 1000; }
        .search-wrapper { position: relative; display: flex; align-items: center; }
        .search-input { width: 100%; padding: 12px 45px 12px 20px; border-radius: 30px; border: 1.5px solid #ffe7f0; outline: none; font-family: 'Tajawal'; transition: 0.3s; box-shadow: 0 4px 12px rgba(235, 47, 150, 0.05); }
        .search-icon { position: absolute; right: 18px; color: var(--p1); font-size: 18px; }

        .page { display: none; padding: 15px; animation: fadeIn 0.5s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from {opacity:0; transform: translateY(10px);} to {opacity:1; transform: translateY(0);} }

        .ai-header-btn { color: white; border: none; width: 100%; padding: 16px; border-radius: 18px; font-weight: bold; margin-bottom: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 12px; font-family: 'Tajawal'; font-size: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .btn-emotions { background: linear-gradient(135deg, #ff85c0, #722ed1); } 
        .btn-intimacy { background: linear-gradient(135deg, #faad14, #eb2f96); } 
        .btn-health { background: linear-gradient(135deg, #eb2f96, #ff4d4f); }    
        .btn-swing { background: linear-gradient(135deg, #722ed1, #eb2f96); }      
        .btn-fiqh { background: linear-gradient(135deg, #52c41a, #722ed1); }      

        .health-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 25px; }
        .tracker-item { background: #fff; padding: 18px 8px; border-radius: 20px; text-align: center; border: 1.5px solid var(--soft); box-shadow: 0 4px 10px rgba(0,0,0,0.02); transition: 0.3s; cursor: pointer; }
        .tracker-item:active { transform: scale(0.95); background: var(--soft); }
        .tracker-item i { font-size: 28px; margin-bottom: 8px; display: block; }
        .tracker-item span { font-size: 12px; font-weight: 700; color: #555; }
        
        .c-1 { color: #ff4d4f; } .c-2 { color: #eb2f96; } .c-3 { color: #722ed1; }
        .c-4 { color: #faad14; } .c-5 { color: #52c41a; } .c-6 { color: #13c2c2; }
        .c-7 { color: #2f54eb; } .c-8 { color: #fa8c16; } .c-9 { color: #eb2f96; }

        .mood-box { background: white; padding: 25px; border-radius: 25px; margin-bottom: 25px; text-align: center; border: 1px solid #ffe7f0; box-shadow: 0 5px 15px rgba(235, 47, 150, 0.05); }
        .mood-slider { width: 100%; accent-color: var(--p2); margin-top: 15px; }
        .mood-val { color: var(--p2); font-weight: bold; font-size: 20px; margin-top: 10px; display: block; }

        .post-card { background: white; border-radius: 25px; padding: 20px; margin-bottom: 20px; border: 1px solid #f0f0f0; box-shadow: 0 4px 12px rgba(0,0,0,0.03); }
        .post-content { font-size: 15px; line-height: 1.8; color: #333; }
        .post-media { width: 100%; border-radius: 18px; margin-top: 15px; max-height: 350px; object-fit: cover; }
        .post-actions { display: flex; border-top: 1px solid #f8f8f8; margin-top: 15px; padding-top: 15px; justify-content: space-around; }
        .action-btn { border: none; background: none; cursor: pointer; color: #777; font-size: 13px; display: flex; align-items: center; gap: 6px; font-family: 'Tajawal'; }
        .action-btn.active-like { color: #ff4d4f; font-weight: bold; }

        /* Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª */
        .comment-section { display: none; margin-top: 15px; border-top: 1px dashed #eee; padding-top: 15px; }
        .comment-input-area { display: flex; gap: 8px; margin-bottom: 12px; }
        .comment-input { flex: 1; padding: 8px 15px; border-radius: 20px; border: 1px solid #eee; font-family: 'Tajawal'; font-size: 13px; }
        .comment-btn { background: var(--p1); color: white; border: none; padding: 5px 12px; border-radius: 15px; cursor: pointer; }
        .comment-list { font-size: 13px; color: #666; }
        .single-comment { background: #f9f9f9; padding: 8px 12px; border-radius: 12px; margin-bottom: 5px; }

        #chat-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 2000; flex-direction: column; }
        .chat-header { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; justify-content: space-between; background: #fff; }
        .chat-messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; background: #fdfbfd; }
        .msg { padding: 14px 18px; border-radius: 22px; max-width: 80%; font-size: 14px; line-height: 1.6; position: relative; }
        .msg-user { align-self: flex-start; background: #f0f0f0; color: #333; }
        .msg-ai { align-self: flex-end; background: var(--p2); color: white; border-bottom-right-radius: 2px; }
        
        .chat-tools { display: flex; gap: 20px; padding: 12px 20px; background: #fff; border-top: 1px solid #f5f5f5; border-bottom: 1px solid #f5f5f5; justify-content: center; }
        .tool-btn { color: var(--p2); font-size: 22px; cursor: pointer; transition: 0.2s; }
        .tool-btn:active { transform: scale(1.2); }

        .chat-footer { padding: 15px; display: flex; gap: 10px; background: white; align-items: center; }
        .chat-input { flex: 1; padding: 12px 20px; border-radius: 30px; border: 1.5px solid #eee; outline: none; font-family: 'Tajawal'; }
        
        #saved-panel { position: absolute; bottom: 140px; left: 15px; right: 15px; background: white; border-radius: 20px; box-shadow: 0 -5px 25px rgba(0,0,0,0.1); display: none; max-height: 300px; overflow-y: auto; z-index: 2100; padding: 15px; border: 1px solid var(--soft); }
        .saved-item { padding: 12px; border-bottom: 1px solid #f9f9f9; font-size: 13px; color: #555; cursor: pointer; }

        .nav-bar { position: fixed; bottom: 0; width: 100%; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); display: flex; border-top: 1px solid #eee; padding: 12px 0 25px 0; z-index: 1000; }
        .nav-link { flex: 1; text-align: center; color: #bbb; text-decoration: none; font-size: 11px; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .nav-link i { font-size: 24px; }
        .nav-link.active { color: var(--p2); font-weight: bold; }

        .swal-label { display: block; text-align: right; margin-top: 12px; font-weight: bold; color: var(--p2); font-size: 14px; }
        .swal-custom-input { width: 100%; padding: 12px; margin-top: 5px; border-radius: 12px; border: 1px solid #ddd; font-family: 'Tajawal'; box-sizing: border-box; }
        
        #hidden-file-input { display: none; }
    </style>
</head>
<body>

    <input type="file" id="hidden-file-input" accept="image/*">

    <header class="top-nav">
        <div class="logo-text">Ø±Ù‚Ø©</div>
    </header>

    <div class="search-container">
        <div class="search-wrapper">
            <i class="fas fa-search search-icon"></i>
            <input type="text" id="main-search-input" class="search-input" placeholder="Ø§Ø¨Ø­Ø«ÙŠ ÙÙŠ Ø¹Ø§Ù„Ù… Ø±Ù‚Ø©..." onkeyup="filterPosts()">
        </div>
    </div>

    <div id="page-health" class="page active">
        <button class="ai-header-btn btn-health" onclick="openAIChat('Ø·Ø¨ÙŠØ¨Ø© Ø±Ù‚Ø©')"><i class="fas fa-stethoscope"></i> Ø·Ø¨ÙŠØ¨Ø© Ø±Ù‚Ø© - ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ</button>
        <div class="health-grid">
            <div class="tracker-item" onclick="showDetailedHealth('menstruation')"><i class="fas fa-tint c-1"></i><span>Ø§Ù„Ø­ÙŠØ¶</span></div>
            <div class="tracker-item" onclick="showDetailedHealth('pregnancy')"><i class="fas fa-baby c-2"></i><span>Ø§Ù„Ø­Ù…Ù„</span></div>
            <div class="tracker-item" onclick="showDetailedHealth('breastfeeding')"><i class="fas fa-magic c-3"></i><span>Ø§Ù„Ø±Ø¶Ø§Ø¹Ø©</span></div>
            <div class="tracker-item" onclick="showDetailedHealth('motherhood')"><i class="fas fa-heart c-9"></i><span>Ø§Ù„Ø£Ù…ÙˆÙ…Ø©</span></div>
            <div class="tracker-item" onclick="showDetailedHealth('doctor')"><i class="fas fa-user-md c-7"></i><span>Ø§Ù„Ø·Ø¨ÙŠØ¨</span></div>
            <div class="tracker-item" onclick="showDetailedHealth('skincare')"><i class="fas fa-spa c-6"></i><span>Ø§Ù„Ø¨Ø´Ø±Ø©</span></div>
            <div class="tracker-item" onclick="showDetailedHealth('weight')"><i class="fas fa-weight c-4"></i><span>Ø§Ù„ÙˆØ²Ù†</span></div>
            <div class="tracker-item" onclick="showDetailedHealth('vitals')"><i class="fas fa-heartbeat c-1"></i><span>Ø§Ù„Ø¶ØºØ· ÙˆØ§Ù„Ø³ÙƒØ±</span></div>
            <div class="tracker-item" onclick="showDetailedHealth('sleep')"><i class="fas fa-moon c-8"></i><span>Ø§Ù„Ù†ÙˆÙ…</span></div>
        </div>
        <div id="health-feed"></div>
    </div>

    <div id="page-swing" class="page">
        <button class="ai-header-btn btn-swing" onclick="openAIChat('Ù…Ø³ØªØ´Ø§Ø±Ø© Ø§Ù„Ø£Ø±Ø¬ÙˆØ­Ø©')"><i class="fas fa-wand-magic-sparkles"></i> Ù…Ø³ØªØ´Ø§Ø±Ø© Ø§Ù„Ø£Ø±Ø¬ÙˆØ­Ø© - Ø¯Ø±Ø¯Ø´Ø© Ø°ÙƒÙŠØ©</button>
        <div id="swing-feed"></div>
    </div>

    <div id="page-emotions" class="page">
        <div class="mood-box">
            <div style="font-weight: bold; font-size: 18px;">ÙƒÙŠÙ Ø­Ø§Ù„ Ù‚Ù„Ø¨ÙƒÙ Ø§Ù„ÙŠÙˆÙ…ØŸ</div>
            <span id="mood-val" class="mood-val">Ù‡Ø§Ø¯Ø¦Ø© ğŸ§˜</span>
            <input type="range" min="1" max="5" value="3" class="mood-slider" oninput="updateMood(this.value)">
        </div>
        <button class="ai-header-btn btn-emotions" onclick="openAIChat('Ø§Ù„Ù…Ø´Ø§Ø¹Ø±')"><i class="fas fa-heart"></i> Ù…Ø³ØªØ´Ø§Ø±Ø© Ø±Ù‚Ø© Ø§Ù„Ù†ÙØ³ÙŠØ©</button>
        <div id="emotions-feed"></div>
    </div>

    <div id="page-intimacy" class="page">
        <button class="ai-header-btn btn-intimacy" onclick="openAIChat('Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª')"><i class="fas fa-venus-mars"></i> Ø§Ø³ØªØ´Ø§Ø±ÙŠØ© Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø­Ù…ÙŠÙ…ÙŠØ©</button>
        <div id="intimacy-feed"></div>
    </div>

    <div id="page-fiqh" class="page">
        <button class="ai-header-btn btn-fiqh" onclick="openAIChat('Ø§Ù„ÙÙ‚Ù‡')"><i class="fas fa-mosque"></i> ÙÙ‚ÙŠÙ‡Ø© Ø±Ù‚Ø©</button>
        <div id="fiqh-feed"></div>
    </div>

    <div id="chat-overlay">
        <div class="chat-header">
            <i class="fas fa-times" onclick="closeChat()" style="font-size: 22px; color: #999; cursor: pointer;"></i>
            <span id="chat-title" style="font-weight:bold; font-size: 18px; color: var(--p2);">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</span>
            <i class="fas fa-trash-alt" onclick="clearChat()" style="color: #ff4d4f; cursor: pointer;"></i>
        </div>
        <div id="chat-messages" class="chat-messages"></div>
        
        <div id="saved-panel">
            <div style="font-weight: bold; border-bottom: 2px solid var(--soft); padding-bottom: 8px; margin-bottom: 10px; color: var(--p2); display: flex; justify-content: space-between;">
                <span>Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© âœ¨</span>
                <i class="fas fa-times" onclick="toggleSaved()" style="cursor:pointer;"></i>
            </div>
            <div id="saved-list"></div>
        </div>

        <div class="chat-tools">
            <i class="fas fa-microphone tool-btn" onclick="aiTool('Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†')"></i>
            <i class="fas fa-camera tool-btn" onclick="aiTool('Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§')"></i>
            <i class="fas fa-image tool-btn" onclick="aiTool('Ø§Ù„Ù…Ø¹Ø±Ø¶')"></i>
            <i class="fas fa-bookmark tool-btn" onclick="toggleSaved()"></i>
        </div>

        <div class="chat-footer">
            <input type="text" id="chat-input" class="chat-input" placeholder="Ø§ÙƒØªØ¨ÙŠ Ø³Ø¤Ø§Ù„ÙƒÙ Ù‡Ù†Ø§...">
            <button onclick="sendMessage()" style="background:var(--p2); color:white; border:none; width:50px; height:50px; border-radius:50%; box-shadow: 0 4px 12px rgba(235, 47, 150, 0.3);"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <nav class="nav-bar">
        <a href="#" class="nav-link" onclick="nav('emotions', this)"><i class="fas fa-smile"></i><span>Ø§Ù„Ù…Ø´Ø§Ø¹Ø±</span></a>
        <a href="#" class="nav-link" onclick="nav('intimacy', this)"><i class="fas fa-venus-mars"></i><span>Ø§Ù„Ø­Ù…ÙŠÙ…ÙŠØ©</span></a>
        <a href="#" class="nav-link active" onclick="nav('health', this)"><i class="fas fa-heartbeat"></i><span>Ø§Ù„ØµØ­Ø©</span></a>
        <a href="#" class="nav-link" onclick="nav('swing', this)"><i class="fas fa-comments"></i><span>Ø£Ø±Ø¬ÙˆØ­Ø©</span></a>
        <a href="#" class="nav-link" onclick="nav('fiqh', this)"><i class="fas fa-mosque"></i><span>Ø§Ù„ÙÙ‚Ù‡</span></a>
    </nav>

    <script>
        const dbMap = { 'emotions': 'bouh-display-1', 'intimacy': 'bouh-display-2', 'health': 'bouh-display-3', 'swing': 'bouh-display-4', 'fiqh': 'bouh-display-5' };
        let savedAIs = JSON.parse(localStorage.getItem('raqqa_saved')) || [];

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„Ø±ÙØ¹
        const fileInput = document.getElementById('hidden-file-input');
        fileInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const container = document.getElementById('chat-messages');
                    container.innerHTML += `
                        <div class="msg msg-user">
                            <img src="${e.target.result}" style="max-width:100%; border-radius:10px; margin-bottom:5px;">
                            <br> Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙÙ‚Ø©...
                        </div>`;
                    container.scrollTop = container.scrollHeight;
                };
                reader.readAsDataURL(this.files[0]);
            }
        });

        function aiTool(name) {
            if (name === 'Ø§Ù„Ù…Ø¹Ø±Ø¶') {
                fileInput.removeAttribute('capture');
                fileInput.click();
            } else if (name === 'Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§') {
                fileInput.setAttribute('capture', 'environment');
                fileInput.click();
            } else if (name === 'Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†') {
                Swal.fire({ title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹...', text: 'ØªØ­Ø¯Ø«ÙŠ Ø§Ù„Ø¢Ù†ØŒ Ø±Ù‚Ø© ØªØ³Ù…Ø¹ÙƒÙ', icon: 'info', showConfirmButton: false, timer: 3000 });
            }
        }

        function toggleComment(id) {
            const section = document.getElementById(`comment-sec-${id}`);
            section.style.display = section.style.display === 'block' ? 'none' : 'block';
        }

        function addComment(id) {
            const input = document.getElementById(`input-${id}`);
            const list = document.getElementById(`list-${id}`);
            if(input.value.trim() === "") return;
            
            const div = document.createElement('div');
            div.className = 'single-comment';
            div.innerText = input.value;
            list.appendChild(div);
            input.value = "";
        }

        // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØµØ­ÙŠØ© (ÙƒÙ…Ø§ Ù‡ÙŠ Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) ---
        function showDetailedHealth(type) {
            let config = {};
            const d = new Date().toISOString().split('T')[0];
            switch(type) {
                case 'menstruation': config = { title: 'Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø­ÙŠØ¶ (Ø§Ù„Ø¯ÙˆØ±Ø©)', html: `<label class="swal-label">ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø²ÙŠÙ:</label><input type="date" id="v1" value="${d}" class="swal-custom-input"><label class="swal-label">ÙƒØ«Ø§ÙØ© Ø§Ù„ØªØ¯ÙÙ‚:</label><select id="v2" class="swal-custom-input"><option>Ø®ÙÙŠÙ Ø¬Ø¯Ø§Ù‹</option><option>Ù…ØªÙˆØ³Ø·</option><option>ØºØ²ÙŠØ±</option><option>Ù†Ø²ÙŠÙ Ø´Ø¯ÙŠØ¯</option></select><label class="swal-label">Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ø§Ù„Ø¬Ø³Ø¯ÙŠØ©:</label><input id="v3" placeholder="ØªÙ‚Ù„ØµØ§ØªØŒ ØµØ¯Ø§Ø¹ØŒ Ø¢Ù„Ø§Ù… Ø¸Ù‡Ø±.." class="swal-custom-input"><label class="swal-label">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ø¬ÙŠØ©:</label><input id="v4" placeholder="ØªÙˆØªØ±ØŒ Ø±ØºØ¨Ø© ÙÙŠ Ø§Ù„Ø¨ÙƒØ§Ø¡ØŒ Ù‡Ø¯ÙˆØ¡.." class="swal-custom-input">` }; break;
                case 'pregnancy': config = { title: 'Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø­Ù…Ù„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©', html: `<label class="swal-label">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ:</label><input type="number" id="v1" placeholder="Ù…Ø«Ù„Ø§Ù‹: 14" class="swal-custom-input"><label class="swal-label">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØºØ«ÙŠØ§Ù†/Ø§Ù„ØªØ¹Ø¨:</label><select id="v2" class="swal-custom-input"><option>Ù…Ù†Ø¹Ø¯Ù…</option><option>Ø¨Ø³ÙŠØ·</option><option>Ø´Ø¯ÙŠØ¯</option></select><label class="swal-label">Ø­Ø±ÙƒØ© Ø§Ù„Ø¬Ù†ÙŠÙ† (Ø¥Ù† ÙˆØ¬Ø¯Øª):</label><input id="v3" placeholder="Ù†Ø´Ø·Ø©ØŒ Ø¶Ø¹ÙŠÙØ©.." class="swal-custom-input"><label class="swal-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø·Ø¨ÙŠØ©:</label><input id="v4" placeholder="ØªÙˆØ±Ù…ØŒ Ø¥ÙØ±Ø§Ø²Ø§ØªØŒ Ø¶ØºØ·.." class="swal-custom-input">` }; break;
                case 'weight': config = { title: 'Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ÙˆØ²Ù† ÙˆØ§Ù„ÙƒØªÙ„Ø©', html: `<label class="swal-label">Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ (ÙƒØ¬Ù…):</label><input type="number" step="0.1" id="v1" class="swal-custom-input"><label class="swal-label">Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…):</label><input type="number" id="v2" class="swal-custom-input"><label class="swal-label">Ø§Ù„Ù‡Ø¯Ù:</label><select id="v3" class="swal-custom-input"><option>Ø¥Ù†Ù‚Ø§Øµ ÙˆØ²Ù†</option><option>Ø«Ø¨Ø§Øª</option><option>Ø²ÙŠØ§Ø¯Ø© ÙˆØ²Ù†</option></select><label class="swal-label">Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø¨Ø¯Ù†ÙŠ:</label><input id="v4" placeholder="Ù…Ø´ÙŠØŒ ÙƒØ§Ø±Ø¯ÙŠÙˆØŒ Ø®Ù…ÙˆÙ„.." class="swal-custom-input">` }; break;
                case 'skincare': config = { title: 'Ù…ØªØ§Ø¨Ø¹Ø© Ù†Ø¶Ø§Ø±Ø© Ø§Ù„Ø¨Ø´Ø±Ø©', html: `<label class="swal-label">Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø´Ø±Ø© Ø§Ù„ÙŠÙˆÙ…:</label><select id="v1" class="swal-custom-input"><option>Ø¯Ù‡Ù†ÙŠØ©</option><option>Ø¬Ø§ÙØ©</option><option>Ù…Ø®ØªÙ„Ø·Ø©</option><option>Ø­Ø³Ø§Ø³Ø©</option></select><label class="swal-label">Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</label><input id="v2" placeholder="Ø¨Ø«ÙˆØ±ØŒ Ø´Ø­ÙˆØ¨ØŒ Ù‡Ø§Ù„Ø§Øª.." class="swal-custom-input"><label class="swal-label">Ø§Ù„Ø±ÙˆØªÙŠÙ† Ø§Ù„Ù…ØªØ¨Ø¹:</label><input id="v3" placeholder="ØªØ±Ø·ÙŠØ¨ØŒ ØªÙ‚Ø´ÙŠØ±ØŒ ÙˆØ§Ù‚ÙŠ Ø´Ù…Ø³.." class="swal-custom-input"><label class="swal-label">ÙƒÙ…ÙŠØ© Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡:</label><input id="v4" placeholder="Ù…Ø«Ù„Ø§Ù‹: 8 Ø£ÙƒÙˆØ§Ø¨" class="swal-custom-input">` }; break;
                case 'vitals': config = { title: 'Ø§Ù„Ø¶ØºØ· ÙˆØ§Ù„Ø³ÙƒØ±', html: `<label class="swal-label">Ø¶ØºØ· Ø§Ù„Ø¯Ù…:</label><input id="v1" placeholder="Ù…Ø«Ù„Ø§Ù‹: 120/80" class="swal-custom-input"><label class="swal-label">Ù…Ø³ØªÙˆÙ‰ Ø³ÙƒØ± Ø§Ù„Ø¯Ù…:</label><input type="number" id="v2" placeholder="ØµØ§Ø¦Ù… Ø£Ùˆ Ø¨Ø¹Ø¯ Ø§Ù„Ø£ÙƒÙ„" class="swal-custom-input"><label class="swal-label">ÙˆÙ‚Øª Ø§Ù„Ù‚ÙŠØ§Ø³:</label><input id="v3" placeholder="ØµØ¨Ø§Ø­Ø§Ù‹ØŒ Ù…Ø³Ø§Ø¡Ù‹.." class="swal-custom-input"><label class="swal-label">Ø£Ø¹Ø±Ø§Ø¶ Ù…Ø±ØªØ¨Ø·Ø©:</label><input id="v4" placeholder="Ø¯ÙˆØ®Ø©ØŒ Ø®ÙÙ‚Ø§Ù†ØŒ Ø¹Ø·Ø´.." class="swal-custom-input">` }; break;
                case 'sleep': config = { title: 'Ù…ØªØ§Ø¨Ø¹Ø© Ø¬ÙˆØ¯Ø© Ø§Ù„Ù†ÙˆÙ…', html: `<label class="swal-label">Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù†ÙˆÙ…:</label><input type="number" step="0.5" id="v1" class="swal-custom-input"><label class="swal-label">Ø¬ÙˆØ¯Ø© Ø§Ù„Ù†ÙˆÙ…:</label><select id="v2" class="swal-custom-input"><option>Ø¹Ù…ÙŠÙ‚ ÙˆÙ…Ø±ÙŠØ­</option><option>Ù…ØªÙ‚Ø·Ø¹</option><option>Ø£Ø±Ù‚ ÙˆØµØ¹ÙˆØ¨Ø©</option></select><label class="swal-label">ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªÙŠÙ‚Ø§Ø¸:</label><input type="time" id="v3" class="swal-custom-input"><label class="swal-label">Ø§Ù„Ø´Ø¹ÙˆØ± Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‡ÙˆØ¶:</label><input id="v4" placeholder="Ù†Ø´Ø·Ø©ØŒ Ø®Ù…ÙˆÙ„ØŒ ØµØ¯Ø§Ø¹.." class="swal-custom-input">` }; break;
                case 'motherhood': config = { title: 'Ø§Ù„Ø£Ù…ÙˆÙ…Ø© ÙˆØ§Ù„Ø·ÙÙ„', html: `<label class="swal-label">Ø¹Ù…Ø± Ø§Ù„Ø·ÙÙ„:</label><input id="v1" class="swal-custom-input"><label class="swal-label">ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…:</label><input id="v2" class="swal-custom-input"><label class="swal-label">Ø³Ù„ÙˆÙƒ Ø§Ù„Ø·ÙÙ„:</label><input id="v3" class="swal-custom-input"><label class="swal-label">ÙˆÙ‚ØªÙƒ Ø§Ù„Ø®Ø§Øµ:</label><input id="v4" placeholder="Ù‡Ù„ Ø­ØµÙ„ØªÙ Ø¹Ù„Ù‰ Ø±Ø§Ø­Ø©ØŸ" class="swal-custom-input">` }; break;
                case 'breastfeeding': config = { title: 'Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø±Ø¶Ø§Ø¹Ø©', html: `<label class="swal-label">Ø§Ù„Ù†ÙˆØ¹:</label><select id="v1" class="swal-custom-input"><option>Ø·Ø¨ÙŠØ¹ÙŠØ©</option><option>ØµÙ†Ø§Ø¹ÙŠØ©</option></select><label class="swal-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø§Øª:</label><input type="number" id="v2" class="swal-custom-input"><label class="swal-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ù„ÙŠØ¨:</label><input id="v3" class="swal-custom-input"><label class="swal-label">Ø¢Ù„Ø§Ù… Ø£Ùˆ ØµØ¹ÙˆØ¨Ø§Øª:</label><input id="v4" class="swal-custom-input">` }; break;
                case 'doctor': config = { title: 'Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ø·Ø¨ÙŠØ¨', html: `<label class="swal-label">Ø§Ù„ØªØ®ØµØµ:</label><input id="v1" class="swal-custom-input"><label class="swal-label">Ø§Ù„ØªØ´Ø®ÙŠØµ:</label><input id="v2" class="swal-custom-input"><label class="swal-label">Ø§Ù„Ø£Ø¯ÙˆÙŠØ©:</label><input id="v3" class="swal-custom-input"><label class="swal-label">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù‚Ø§Ø¯Ù…:</label><input type="date" id="v4" class="swal-custom-input">` }; break;
                default: config = { title: 'Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ©', html: `<input id="v1" class="swal-custom-input">` };
            }

            Swal.fire({
                title: config.title,
                html: config.html,
                confirmButtonText: 'ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ âœ¨',
                confirmButtonColor: '#eb2f96',
                showCancelButton: true,
                preConfirm: () => {
                    let res = "";
                    for(let i=1; i<=4; i++) {
                        let el = document.getElementById('v'+i);
                        if(el) {
                            let label = el.previousSibling ? el.previousSibling.innerText : "Ø¨ÙŠØ§Ù†Ø§Øª";
                            res += label + ": " + el.value + " | ";
                        }
                    }
                    return res;
                }
            }).then(r => { if(r.isConfirmed) { openAIChat('ØªØ­Ù„ÙŠÙ„ Ø±Ù‚Ø©'); sendMessage(true, `Ø¨ÙŠØ§Ù†Ø§ØªÙŠ Ø§Ù„ØµØ­ÙŠØ© Ø§Ù„Ù…ÙØµÙ„Ø©: ${r.value}. Ù‚Ø¯Ù…ÙŠ Ù„ÙŠ ØªØ­Ù„ÙŠÙ„Ø§Ù‹ Ù…Ù„ÙƒÙŠØ§Ù‹ ÙˆÙ†ØµØ§Ø¦Ø­ Ø¯Ù‚ÙŠÙ‚Ø©.`); } });
        }

        async function fetchContent(tab) {
            const feed = document.getElementById(tab + '-feed');
            feed.innerHTML = '<div style="text-align:center; padding:40px;"><i class="fas fa-spinner fa-spin" style="font-size:30px; color:var(--p2);"></i></div>';
            try {
                const res = await fetch('/api/get-posts');
                const data = await res.json();
                const filtered = data.posts.filter(p => p.section === dbMap[tab]);
                feed.innerHTML = filtered.length ? filtered.map((p, idx) => `
                    <div class="post-card">
                        <div class="post-content">${p.content}</div>
                        ${p.media_url ? (p.media_url.match(/\.(mp4|webm|mov)$/i) ? `<video src="${p.media_url}" class="post-media" controls></video>` : `<img src="${p.media_url}" class="post-media">`) : ''}
                        <div class="post-actions">
                            <button class="action-btn" onclick="this.classList.toggle('active-like')"><i class="far fa-heart"></i> Ø¥Ø¹Ø¬Ø§Ø¨</button>
                            <button class="action-btn" onclick="toggleComment('${idx}')"><i class="far fa-comment"></i> ØªØ¹Ù„ÙŠÙ‚</button>
                            <button class="action-btn" onclick="sharePost(\`${p.content}\`)"><i class="far fa-share-square"></i> Ù…Ø´Ø§Ø±ÙƒØ©</button>
                        </div>
                        <div class="comment-section" id="comment-sec-${idx}">
                            <div class="comment-input-area">
                                <input type="text" id="input-${idx}" class="comment-input" placeholder="Ø§ÙƒØªØ¨ÙŠ ØªØ¹Ù„ÙŠÙ‚ÙƒÙ...">
                                <button class="comment-btn" onclick="addComment('${idx}')">Ù†Ø´Ø±</button>
                            </div>
                            <div class="comment-list" id="list-${idx}"></div>
                        </div>
                    </div>`).join('') : '<p style="text-align:center; padding:20px; color:#999;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø­Ø§Ù„ÙŠØ§Ù‹.</p>';
            } catch(e) { feed.innerHTML = '<p style="text-align:center;">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….</p>'; }
        }

        function openAIChat(title) {
            document.getElementById('chat-title').innerText = title;
            document.getElementById('chat-overlay').style.display = 'flex';
        }
        function closeChat() { document.getElementById('chat-overlay').style.display = 'none'; }
        function clearChat() { document.getElementById('chat-messages').innerHTML = ''; }

        async function sendMessage(auto = false, msgText = null) {
            const input = document.getElementById('chat-input');
            const text = msgText || input.value;
            if(!text) return;
            const container = document.getElementById('chat-messages');
            container.innerHTML += `<div class="msg msg-user">${text}</div>`;
            if(!auto) input.value = '';
            try {
                const res = await fetch('/api/raqqa-ai', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ prompt: text }) });
                const data = await res.json();
                const reply = data.reply || "Ø£Ù†Ø§ Ù…Ø¹ÙƒÙ ÙŠØ§ Ø¬Ù…ÙŠÙ„Ø©.. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø¯Ø¹Ù…ÙƒÙ Ø£ÙƒØ«Ø±ØŸ";
                container.innerHTML += `<div class="msg msg-ai">${reply} <br><small onclick="saveAI('${reply.replace(/'/g, "\\'")}')" style="cursor:pointer; color:#eee; text-decoration:underline; font-size:10px; display:block; margin-top:5px;">Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª âœ¨</small></div>`;
            } catch(e) { container.innerHTML += `<div class="msg msg-ai">Ø£Ù†Ø§ Ù‡Ù†Ø§ Ø¨Ø¬Ø§Ù†Ø¨Ùƒ.. Ù‡Ù„ ØªØ±ØºØ¨ÙŠÙ† ÙÙŠ ØªØ³Ø¬ÙŠÙ„ÙŠ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø© Ø£Ø®Ø±Ù‰ØŸ <br><small onclick="saveAI('Ø£Ù†Ø§ Ù‡Ù†Ø§ Ø¨Ø¬Ø§Ù†Ø¨Ùƒ..')" style="cursor:pointer; color:#eee; text-decoration:underline; font-size:10px; display:block; margin-top:5px;">Ø­ÙØ¸ âœ¨</small></div>`; }
            container.scrollTop = container.scrollHeight;
        }

        function saveAI(text) {
            savedAIs.push(text);
            localStorage.setItem('raqqa_saved', JSON.stringify(savedAIs));
            Swal.fire({ toast: true, position: 'top-end', icon: 'success', title: 'ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª!', showConfirmButton: false, timer: 1500 });
        }

        function toggleSaved() {
            const panel = document.getElementById('saved-panel');
            panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
            document.getElementById('saved-list').innerHTML = savedAIs.length ? savedAIs.map((t, i) => `<div class="saved-item" onclick="document.getElementById('chat-input').value='${t}'; toggleSaved();">${t.substring(0, 50)}...</div>`).join('') : '<p style="text-align:center; font-size:12px; color:#999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­ÙÙˆØ¸Ø§Øª Ø¨Ø¹Ø¯</p>';
        }

        function nav(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            document.getElementById('page-'+id).classList.add('active'); 
            el.classList.add('active');
            fetchContent(id);
        }

        function updateMood(val) {
            const moods = ["", "Ø­Ø²ÙŠÙ†Ø© ğŸ˜”", "Ù‚Ù„Ù‚Ø© ğŸ˜Ÿ", "Ù‡Ø§Ø¯Ø¦Ø© ğŸ§˜", "Ø³Ø¹ÙŠØ¯Ø© ğŸ˜Š", "Ù…Ø¨ØªÙ‡Ø¬Ø© âœ¨"];
            document.getElementById('mood-val').innerText = moods[val];
        }

        async function sharePost(content) {
            if (navigator.share) navigator.share({ title: 'ØªØ·Ø¨ÙŠÙ‚ Ø±Ù‚Ø©', text: content });
            else { navigator.clipboard.writeText(content); Swal.fire({ toast: true, title: 'ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ', icon: 'success', showConfirmButton: false, timer: 1000 }); }
        }

        window.onload = () => fetchContent('health');
    </script>
</body>
    </html>
